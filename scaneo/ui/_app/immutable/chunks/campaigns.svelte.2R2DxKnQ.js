import{p as c}from"./proxy.BT_Zq6Rg.js";import{N as l,g as r,o as e}from"./runtime.B6coxiGD.js";import{f as $,P as d}from"./fetcher.BMDzGJ_8.js";async function E(){const n=`${d}/_campaigns`;return $(n)}async function O(n){const i=`${d}/_campaigns/${n}`;return $(i)}const S=async n=>{const i=`${d}/_campaigns/${n}`;return $(i,"DELETE")};function v(){let n=l(c([])),i=l(!0),y=l(null),w=l(null),g=l(0),p=l(""),u=l(null),m=l(!1),f=l(!1);const _=(a,s)=>{e(u,c(new WebSocket(`${d.replace("https://","ws://")}/_campaigns/${s}`))),r(u).onmessage=o=>{const t=JSON.parse(o.data);t.status==="processing"?(e(g,c(parseFloat(t.progress))),e(p,c(t.message)),e(m,!0)):t.status==="complete"?(console.log("complete"),console.log(t.data),e(n,c([t.data,...r(n)])),e(g,1),e(p,"Campaign created"),e(m,!1),e(f,!0)):t.status==="error"&&(console.log("error"),console.log(t.error),e(g,1),e(p,"Error creating campaign"),e(m,!1),e(f,!1),alert(t.error))},r(u).onopen=()=>{e(g,0),e(p,"Creating campaign..."),e(m,!0),e(f,!1),r(u).send(JSON.stringify(a))}};return{get data(){return r(n)},get loading(){return r(i)},get error(){return r(y)},get current(){return r(w)},get progress(){return r(g)},get message(){return r(p)},get creating(){return r(m)},get completed(){return r(f)},reset:()=>{e(g,0),e(p,""),e(m,!1),e(f,!1)},retrieve:async()=>{e(i,!0);const{data:a,error:s}=await E();s&&e(y,c(s.message)),e(n,c(a)),e(i,!1)},create:async(a,s,o,t,C)=>{_({name:a,description:s,path:o,labels:t,labelMappings:C},"create")},createEOTDL:async(a,s,o,t,C)=>{_({name:a,description:s,eotdlDatasetId:o,labels:t,labelMappings:C},"create-eotdl")},import:async(a,s,o)=>{_({name:a,description:s,path:o},"import")},cancel:()=>{r(u)&&r(u).readyState===WebSocket.OPEN&&(r(u).close(),e(p,"Cancelled"),e(g,0),e(m,!1),e(f,!1))},delete:async a=>{const{data:s,error:o}=await S(a);o&&console.error(o),e(n,c(r(n).filter(t=>t.id!==a)))},retrieveOne:async a=>{const{data:s,error:o}=await O(a);o&&console.error(r(y)),e(w,c(s))}}}const W=v();export{W as c};
