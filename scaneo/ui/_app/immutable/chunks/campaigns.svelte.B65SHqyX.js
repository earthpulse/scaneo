import{p as l}from"./proxy.D4aqs5o-.js";import{e as p,g as a,b as e}from"./runtime.cJOh_ioU.js";import{b as _,f as $}from"./fetcher.C3wkiN9W.js";async function O(){const n=`${_.api_url}/_campaigns`;return $(n)}async function b(n){const f=`${_.api_url}/_campaigns/${n}`;return $(f)}const w=async n=>{const f=`${_.api_url}/_campaigns/${n}`;return $(f,"DELETE")};function N(){let n=p(l([])),f=p(!0),y=p(null),C=p(null),c=p(0),i=p(""),g=p(null),m=p(!1),d=p(!1),u=p(!1);const x=(t,s)=>{e(g,l(new WebSocket(`${_.api_url}/_campaigns/${s}`))),a(g).onmessage=o=>{const r=JSON.parse(o.data);r.status==="processing"?(e(c,l(parseFloat(r.progress))),e(i,l(r.message)),e(m,!0)):r.status==="complete"?(console.log("complete"),e(n,l([r.data,...a(n)])),e(c,1),e(i,"Campaign created"),e(m,!1),e(u,!0)):r.status==="error"&&(console.log("error"),console.log(r.error),e(c,1),e(i,"Error creating campaign"),e(m,!1),e(u,!1),alert(r.error))},a(g).onopen=()=>{e(c,0),e(i,"Creating campaign..."),e(m,!0),e(u,!1),a(g).send(JSON.stringify(t))}},E=(t,s)=>{e(g,l(new WebSocket(`${_.api_url}/_campaigns/${t}/export`))),a(g).onmessage=o=>{const r=JSON.parse(o.data);r.status==="exporting"?(e(c,l(parseFloat(r.progress))),e(i,l(r.message)),e(d,!0)):r.status==="complete"?(console.log("complete"),e(c,1),e(i,"Campaign exported"),e(d,!1),e(u,!0)):r.status==="error"&&(console.log("error"),console.log(r.error),e(c,1),e(i,"Error exporting campaign"),e(d,!1),e(u,!1),alert(r.error))},a(g).onopen=()=>{e(c,0),e(i,"Exporting campaign..."),e(d,!0),e(u,!1),a(g).send(JSON.stringify(s))}};return{get data(){return a(n)},get loading(){return a(f)},get error(){return a(y)},get current(){return a(C)},get progress(){return a(c)},get message(){return a(i)},get creating(){return a(m)},get exporting(){return a(d)},get completed(){return a(u)},reset:()=>{e(c,0),e(i,""),e(m,!1),e(d,!1),e(u,!1)},retrieve:async()=>{e(f,!0);const{data:t,error:s}=await O();s&&e(y,l(s.message)),e(n,l(t)),e(f,!1)},create:async(t,s,o,r,S)=>{x({name:t,description:s,path:o,labels:r,labelMappings:S},"create")},createEOTDL:async(t,s,o,r,S)=>{x({name:t,description:s,eotdlDatasetId:o,labels:r,labelMappings:S},"create-eotdl")},import:async(t,s,o)=>{x({name:t,description:s,path:o},"import")},cancel:()=>{a(g)&&a(g).readyState===WebSocket.OPEN&&(a(g).close(),e(i,"Cancelled"),e(c,0),e(m,!1),e(d,!1),e(u,!1))},delete:async t=>{const{data:s,error:o}=await w(t);o&&console.error(o),e(n,l(a(n).filter(r=>r.id!==t)))},retrieveOne:async t=>{const{data:s,error:o}=await b(t);o&&console.error(a(y)),e(C,l(s))},export:async(t,s,o)=>{E(t,{exportType:s,exportPath:o})}}}const k=N();export{k as c};
