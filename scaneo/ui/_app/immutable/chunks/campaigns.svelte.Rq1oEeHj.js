import{p as l}from"./proxy.DqozBE76.js";import{e as g,g as r,b as e}from"./runtime.DxIuT8bo.js";import{b as y,f as S}from"./fetcher.DqgCpJxC.js";async function E(){const n=`${y.api_url}/_campaigns`;return S(n)}async function O(n){const m=`${y.api_url}/_campaigns/${n}`;return S(m)}const b=async n=>{const m=`${y.api_url}/_campaigns/${n}`;return S(m,"DELETE")};function N(){let n=g(l([])),m=g(!0),x=g(null),$=g(null),c=g(0),i=g(""),p=g(null),d=g(!1),_=g(!1),u=g(!1);const w=(a,s)=>{const o=y.api_url.replace(/^http/,"ws");e(p,l(new WebSocket(`${o}/_campaigns/${s}`))),r(p).onmessage=f=>{const t=JSON.parse(f.data);t.status==="processing"?(e(c,l(parseFloat(t.progress))),e(i,l(t.message)),e(d,!0)):t.status==="complete"?(console.log("complete"),e(n,l([t.data,...r(n)])),e(c,1),e(i,"Campaign created"),e(d,!1),e(u,!0)):t.status==="error"&&(console.log("error"),console.log(t.error),e(c,1),e(i,"Error creating campaign"),e(d,!1),e(u,!1),alert(t.error))},r(p).onopen=()=>{e(c,0),e(i,"Creating campaign..."),e(d,!0),e(u,!1),r(p).send(JSON.stringify(a))}},C=(a,s)=>{const o=y.api_url.replace(/^http/,"ws");e(p,l(new WebSocket(`${o}/_campaigns/${a}/export`))),r(p).onmessage=f=>{const t=JSON.parse(f.data);t.status==="exporting"?(e(c,l(parseFloat(t.progress))),e(i,l(t.message)),e(_,!0)):t.status==="complete"?(console.log("complete"),e(c,1),e(i,"Campaign exported"),e(_,!1),e(u,!0)):t.status==="error"&&(console.log("error"),console.log(t.error),e(c,1),e(i,"Error exporting campaign"),e(_,!1),e(u,!1),alert(t.error))},r(p).onopen=()=>{e(c,0),e(i,"Exporting campaign..."),e(_,!0),e(u,!1),r(p).send(JSON.stringify(s))}};return{get data(){return r(n)},get loading(){return r(m)},get error(){return r(x)},get current(){return r($)},get progress(){return r(c)},get message(){return r(i)},get creating(){return r(d)},get exporting(){return r(_)},get completed(){return r(u)},reset:()=>{e(c,0),e(i,""),e(d,!1),e(_,!1),e(u,!1)},retrieve:async()=>{e(m,!0);const{data:a,error:s}=await E();s&&e(x,l(s.message)),e(n,l(a)),e(m,!1)},create:async(a,s,o,f,t)=>{w({name:a,description:s,path:o,labels:f,labelMappings:t},"create")},createEOTDL:async(a,s,o,f,t)=>{w({name:a,description:s,eotdlDatasetName:o,labels:f,labelMappings:t},"create-eotdl")},import:async(a,s,o)=>{w({name:a,description:s,path:o},"import")},cancel:()=>{r(p)&&r(p).readyState===WebSocket.OPEN&&(r(p).close(),e(i,"Cancelled"),e(c,0),e(d,!1),e(_,!1),e(u,!1))},delete:async a=>{const{data:s,error:o}=await b(a);o&&console.error(o),e(n,l(r(n).filter(f=>f.id!==a)))},retrieveOne:async a=>{const{data:s,error:o}=await O(a);o&&console.error(r(x)),e($,l(s))},export:async(a,s,o)=>{C(a,{exportType:s,exportPath:o})}}}const h=N();export{h as c};
