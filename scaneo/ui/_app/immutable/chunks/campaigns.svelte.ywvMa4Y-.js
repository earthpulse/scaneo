import{p as l}from"./proxy.B3-__M_J.js";import{e as p,g as r,b as e}from"./runtime.B40kIuYm.js";import{f as C,P as S}from"./fetcher.BMDzGJ_8.js";import{b as w}from"./baseUrl.svelte.CLVn2HCS.js";async function O(){const n=`${w.url}/_campaigns`;return C(n)}async function b(n){const u=`${w.url}/_campaigns/${n}`;return C(u)}const N=async n=>{const u=`${S}/_campaigns/${n}`;return C(u,"DELETE")};function W(){let n=p(l([])),u=p(!0),y=p(null),$=p(null),c=p(0),i=p(""),g=p(null),m=p(!1),d=p(!1),f=p(!1);const _=(a,s)=>{e(g,l(new WebSocket(`${S.replace("https://","ws://")}/_campaigns/${s}`))),r(g).onmessage=t=>{const o=JSON.parse(t.data);o.status==="processing"?(e(c,l(parseFloat(o.progress))),e(i,l(o.message)),e(m,!0)):o.status==="complete"?(console.log("complete"),e(n,l([o.data,...r(n)])),e(c,1),e(i,"Campaign created"),e(m,!1),e(f,!0)):o.status==="error"&&(console.log("error"),console.log(o.error),e(c,1),e(i,"Error creating campaign"),e(m,!1),e(f,!1),alert(o.error))},r(g).onopen=()=>{e(c,0),e(i,"Creating campaign..."),e(m,!0),e(f,!1),r(g).send(JSON.stringify(a))}},E=a=>{e(g,l(new WebSocket(`${S.replace("https://","ws://")}/_campaigns/${a}/export`))),r(g).onmessage=s=>{const t=JSON.parse(s.data);t.status==="exporting"?(e(c,l(parseFloat(t.progress))),e(i,l(t.message)),e(d,!0)):t.status==="complete"?(console.log("complete"),e(c,1),e(i,"Campaign exported"),e(d,!1),e(f,!0)):t.status==="error"&&(console.log("error"),console.log(t.error),e(c,1),e(i,"Error exporting campaign"),e(d,!1),e(f,!1),alert(t.error))},r(g).onopen=()=>{e(c,0),e(i,"Exporting campaign..."),e(d,!0),e(f,!1),r(g).send(JSON.stringify({}))}};return{get data(){return r(n)},get loading(){return r(u)},get error(){return r(y)},get current(){return r($)},get progress(){return r(c)},get message(){return r(i)},get creating(){return r(m)},get exporting(){return r(d)},get completed(){return r(f)},reset:()=>{e(c,0),e(i,""),e(m,!1),e(d,!1),e(f,!1)},retrieve:async()=>{e(u,!0);const{data:a,error:s}=await O();s&&e(y,l(s.message)),e(n,l(a)),e(u,!1)},create:async(a,s,t,o,x)=>{_({name:a,description:s,path:t,labels:o,labelMappings:x},"create")},createEOTDL:async(a,s,t,o,x)=>{_({name:a,description:s,eotdlDatasetId:t,labels:o,labelMappings:x},"create-eotdl")},import:async(a,s,t)=>{_({name:a,description:s,path:t},"import")},cancel:()=>{r(g)&&r(g).readyState===WebSocket.OPEN&&(r(g).close(),e(i,"Cancelled"),e(c,0),e(m,!1),e(d,!1),e(f,!1))},delete:async a=>{const{data:s,error:t}=await N(a);t&&console.error(t),e(n,l(r(n).filter(o=>o.id!==a)))},retrieveOne:async a=>{const{data:s,error:t}=await b(a);t&&console.error(r(y)),e($,l(s))},export:async a=>{E(a)}}}const h=W();export{h as c};
