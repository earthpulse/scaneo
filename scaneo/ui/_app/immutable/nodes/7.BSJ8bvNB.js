const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../assets/leaflet.GL2v8lVq.css","../assets/leaflet.jCI8mrZJ.css"])))=>i.map(i=>d[i]);
import{a as E,n as M,t as P,c as _e}from"../chunks/disclose-version.DymP2m3X.js";import{b,g as t,a6 as Qe,t as D,c as m,s as C,r as h,e as k,p as j,u as G,a as F,f as Q,d as Fe,aE as Xe,aF as Ye}from"../chunks/runtime.cJOh_ioU.js";import{i as A}from"../chunks/if.Bhj5v8Zz.js";import{p as I}from"../chunks/proxy.D4aqs5o-.js";import{s as Ae,a as ke}from"../chunks/store.CySFX2Po.js";import{d as we,e as He}from"../chunks/events.BOQTMbzA.js";import{a as te,s as $}from"../chunks/class.CftKStsF.js";import{s as V}from"../chunks/render.Gnl0czpM.js";import{s as w,r as ve,a as Ie}from"../chunks/attributes.CayNqfGD.js";import{p as d}from"../chunks/props.B7tyearX.js";import{_ as fe}from"../chunks/preload-helper.C1FmrZbK.js";import{b as X,f as oe}from"../chunks/fetcher.C3wkiN9W.js";import{l as Z,L as $e}from"../chunks/Labels.CZ72FIhV.js";import{o as Le}from"../chunks/index-client.BS7WnwP4.js";import{m as he}from"../chunks/models.svelte.ChP3fjK-.js";import{e as me,i as be}from"../chunks/each.4KclU_0W.js";import{b as et,D as tt}from"../chunks/DeleteOutline.hmBvqWE8.js";import{p as Ve}from"../chunks/stores.BwfGbC9s.js";import{E as at}from"../chunks/ExportBtn.BkRmAOCz.js";import{s as rt}from"../chunks/snippet.CdFhtc_7.js";import{i as Ge}from"../chunks/lifecycle.DM9IC38U.js";import{b as ot,a as nt}from"../chunks/input.CvnAJZ7U.js";import{c as De}from"../chunks/campaigns.svelte.B65SHqyX.js";function it(r){var e=Qe(0);return function(){return arguments.length===1?(b(e,t(e)+1),arguments[0]):(t(e),r())}}var lt=M("<desc> </desc>"),st=M("<title> </title>"),ct=M('<svg><!><!><path d="M12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5M12,2A7,7 0 0,1 19,9C19,14.25 12,22 12,22C12,22 5,14.25 5,9A7,7 0 0,1 12,2M12,4A5,5 0 0,0 7,9C7,10 7,12 12,18.71C17,12 17,10 17,9A5,5 0 0,0 12,4Z"></path></svg>');function dt(r,e){let a=d(e,"size",8,"1em"),n=d(e,"width",24,a),i=d(e,"height",24,a),s=d(e,"color",8,"currentColor"),f=d(e,"viewBox",8,"0 0 24 24"),u=d(e,"ariaLabel",24,()=>{}),_=d(e,"ariaHidden",24,()=>{}),v=d(e,"title",24,()=>{}),l=d(e,"desc",24,()=>{}),c=d(e,"class",24,()=>{});var o=ct(),y=m(o);A(y,l,H=>{var g=lt(),x=m(g);h(g),D(()=>V(x,l())),E(H,g)});var p=C(y);A(p,v,H=>{var g=st(),x=m(g);h(g),D(()=>V(x,v())),E(H,g)});var B=C(p);h(o),D(()=>{w(o,"viewBox",f()),w(o,"width",n()),w(o,"height",i()),te(o,c()),w(o,"aria-label",u()),w(o,"aria-hidden",_()),w(B,"fill",s())}),E(r,o)}var vt=M("<desc> </desc>"),ut=M("<title> </title>"),ft=M('<svg><!><!><path d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"></path></svg>');function gt(r,e){let a=d(e,"size",8,"1em"),n=d(e,"width",24,a),i=d(e,"height",24,a),s=d(e,"color",8,"currentColor"),f=d(e,"viewBox",8,"0 0 24 24"),u=d(e,"ariaLabel",24,()=>{}),_=d(e,"ariaHidden",24,()=>{}),v=d(e,"title",24,()=>{}),l=d(e,"desc",24,()=>{}),c=d(e,"class",24,()=>{});var o=ft(),y=m(o);A(y,l,H=>{var g=vt(),x=m(g);h(g),D(()=>V(x,l())),E(H,g)});var p=C(y);A(p,v,H=>{var g=ut(),x=m(g);h(g),D(()=>V(x,v())),E(H,g)});var B=C(p);h(o),D(()=>{w(o,"viewBox",f()),w(o,"width",n()),w(o,"height",i()),te(o,c()),w(o,"aria-label",u()),w(o,"aria-hidden",_()),w(B,"fill",s())}),E(r,o)}var _t=M("<desc> </desc>"),ht=M("<title> </title>"),mt=M('<svg><!><!><path d="M5,3C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19H5V5H12V3H5M17.78,4C17.61,4 17.43,4.07 17.3,4.2L16.08,5.41L18.58,7.91L19.8,6.7C20.06,6.44 20.06,6 19.8,5.75L18.25,4.2C18.12,4.07 17.95,4 17.78,4M15.37,6.12L8,13.5V16H10.5L17.87,8.62L15.37,6.12Z"></path></svg>');function bt(r,e){let a=d(e,"size",8,"1em"),n=d(e,"width",24,a),i=d(e,"height",24,a),s=d(e,"color",8,"currentColor"),f=d(e,"viewBox",8,"0 0 24 24"),u=d(e,"ariaLabel",24,()=>{}),_=d(e,"ariaHidden",24,()=>{}),v=d(e,"title",24,()=>{}),l=d(e,"desc",24,()=>{}),c=d(e,"class",24,()=>{});var o=mt(),y=m(o);A(y,l,H=>{var g=_t(),x=m(g);h(g),D(()=>V(x,l())),E(H,g)});var p=C(y);A(p,v,H=>{var g=ht(),x=m(g);h(g),D(()=>V(x,v())),E(H,g)});var B=C(p);h(o),D(()=>{w(o,"viewBox",f()),w(o,"width",n()),w(o,"height",i()),te(o,c()),w(o,"aria-label",u()),w(o,"aria-hidden",_()),w(B,"fill",s())}),E(r,o)}var wt=M("<desc> </desc>"),Lt=M("<title> </title>"),yt=M('<svg><!><!><path d="M2,2V8H4.28L5.57,16H4V22H10V20.06L15,20.05V22H21V16H19.17L20,9H22V3H16V6.53L14.8,8H9.59L8,5.82V2M4,4H6V6H4M18,5H20V7H18M6.31,8H7.11L9,10.59V14H15V10.91L16.57,9H18L17.16,16H15V18.06H10V16H7.6M11,10H13V12H11M6,18H8V20H6M17,18H19V20H17"></path></svg>');function pt(r,e){let a=d(e,"size",8,"1em"),n=d(e,"width",24,a),i=d(e,"height",24,a),s=d(e,"color",8,"currentColor"),f=d(e,"viewBox",8,"0 0 24 24"),u=d(e,"ariaLabel",24,()=>{}),_=d(e,"ariaHidden",24,()=>{}),v=d(e,"title",24,()=>{}),l=d(e,"desc",24,()=>{}),c=d(e,"class",24,()=>{});var o=yt(),y=m(o);A(y,l,H=>{var g=wt(),x=m(g);h(g),D(()=>V(x,l())),E(H,g)});var p=C(y);A(p,v,H=>{var g=Lt(),x=m(g);h(g),D(()=>V(x,v())),E(H,g)});var B=C(p);h(o),D(()=>{w(o,"viewBox",f()),w(o,"width",n()),w(o,"height",i()),te(o,c()),w(o,"aria-label",u()),w(o,"aria-hidden",_()),w(B,"fill",s())}),E(r,o)}function xt(){let r=k(null);return{get map(){return t(r)},set map(e){b(r,I(e))}}}const T=xt(),Ct=async r=>{const e=`${X.api_url}/annotations/${r}`;return oe(e)};async function Et(r,e){const a=`${X.api_url}/annotations/classification`;return oe(a,"POST",{label:r,imageId:e})}async function Ht(r,e,a){const n=`${X.api_url}/annotations/detection`;return oe(n,"POST",{bb:r,label:e,imageId:a})}async function It(r,e,a){const n=`${X.api_url}/annotations/segmentation`;return oe(n,"POST",{layer_data:r,label:e,imageId:a})}async function Bt(r,e,a){const n=`${X.api_url}/annotations/points`;return oe(n,"POST",{points:r,label:e,imageId:a})}const Dt=async r=>{const e=`${X.api_url}/annotations/${r}`;return oe(e,"DELETE")};async function At(r,e){const a=`${X.api_url}/annotations/detection/${r}`;return oe(a,"PUT",{bb:e})}async function kt(r,e){const a=`${X.api_url}/annotations/points/${r}`;return oe(a,"PUT",{points:e})}function Vt(){let r=k(I([])),e=k(!0),a=k(null),n=k(null);return{get data(){return t(r)},get loading(){return t(e)},get error(){return t(a)},get current(){return t(n)},set current(i){b(n,I(i))},retrieve:async i=>{b(e,!0);const{data:s,error:f}=await Ct(i);return f&&b(a,I(f.message)),b(r,I(s)),b(e,!1),s},createClassification:async(i,s)=>{const{data:f,error:u}=await Et(i,s);if(u)throw new Error(u.message);t(r).find(_=>_.id===f.id)?b(r,I(t(r).map(_=>_.id===f.id?f:_))):b(r,I([f,...t(r)]))},createDetection:async(i,s,f)=>{const{data:u,error:_}=await Ht(i,s,f);if(_)throw new Error(_.message);return b(r,I([u,...t(r)])),u},updateDetection:async(i,s)=>{const{data:f,error:u}=await At(i,s);if(u)throw new Error(u.message);b(r,I(t(r).map(_=>_.id===i?{..._,bb:s}:_)))},createSegmentation:async(i,s,f)=>{const{data:u,error:_}=await It(i,s,f);if(_)throw new Error(_.message);return b(r,I([u,...t(r)])),u},createPoints:async(i,s,f)=>{const{data:u,error:_}=await Bt(i,s,f);if(_)throw new Error(_.message);return b(r,I([u,...t(r)])),u},updatePoints:async(i,s)=>{const{data:f,error:u}=await kt(i,s);if(u)throw new Error(u.message);b(r,I(t(r).map(_=>_.id===i?{..._,points:s}:_)))},delete:async i=>{const{error:s}=await Dt(i);if(s)throw new Error(s.message);b(r,I(t(r).filter(f=>f.id!==i)))},reset:()=>{b(r,I([])),b(e,!0),b(a,null),b(n,null)},append:i=>{b(r,I([...i,...t(r)]))}}}const O=Vt(),Mt=async r=>{const e=`${X.api_url}/images/${r}`;return oe(e)};function St(){let r=k(I([])),e=k(!0),a=k(null),n=k(null);return{get data(){return t(r)},get loading(){return t(e)},get error(){return t(a)},get current(){return t(n)},set current(i){b(n,I(i))},retrieve:async i=>{b(e,!0);const{data:s,error:f}=await Mt(i);f&&b(a,I(f.message)),b(r,I(s)),b(e,!1)},zoom:(i,s)=>{const f=L.latLng(i[1],i[0]),u=L.latLng(i[3],i[2]),_=L.latLngBounds(f,u);s.fitBounds(_)},reset:()=>{b(r,I([])),b(e,!0),b(a,null),b(n,null)}}}const S=St();function zt(){let r=k(null),e=k(null),a,n,i;const s=async l=>{const{layer:c}=l,o=c.getBounds(),y=await O.createDetection([[o._southWest.lat,o._northEast.lng],[o._northEast.lat,o._southWest.lng]],Z.current,S.current.id);c.options.color=Z.data.filter(p=>y.value==p.name)[0].color,c.annotationId=y.id,t(r).addLayer(c)},f=l=>{l.layers.eachLayer(c=>{const o=c.getBounds();O.updateDetection(c.annotationId,[[o._southWest.lat,o._northEast.lng],[o._northEast.lat,o._southWest.lng]])})},u=l=>{l.layers.eachLayer(c=>{O.delete(c.annotationId)})},_=l=>{t(r)?t(r).clearLayers():b(r,I(new L.FeatureGroup)),l.addLayer(t(r))};return{initItems:_,initControls:l=>{t(r)||_(l),a&&l.off(L.Draw.Event.CREATED,a),n&&l.off(L.Draw.Event.EDITED,n),i&&l.off(L.Draw.Event.DELETED,i),t(e)&&l.removeControl(t(e)),b(e,I(new L.Control.Draw({position:"topright",edit:{featureGroup:t(r)},draw:{polyline:!1,circlemarker:!1,circle:!1,marker:!1,rectangle:{repeatMode:!0,showArea:!1,showLength:!0,shapeOptions:{weight:1}},polygon:!1}}))),l.addControl(t(e)),a=async c=>await s(c),n=f,i=u,l.on(L.Draw.Event.CREATED,a),l.on(L.Draw.Event.EDITED,n),l.on(L.Draw.Event.DELETED,i)},remove:l=>{t(r)&&(l==null||l.removeLayer(t(r))),t(e)&&(l==null||l.removeControl(t(e))),a&&l.off(L.Draw.Event.CREATED,a),n&&l.off(L.Draw.Event.EDITED,n),i&&l.off(L.Draw.Event.DELETED,i),b(r,null),b(e,null)},addLayer:l=>{const c=l.bb,o=L.rectangle([[c[0][0],c[0][1]],[c[1][0],c[1][1]]],{editing:!0});o.options.color=Z.data.filter(y=>l.value==y.name)[0].color,o.annotationId=l.id,t(r).addLayer(o)},removeLayer:l=>{var c;(c=t(r))==null||c.eachLayer(o=>{o.annotationId===l&&t(r).removeLayer(o)})}}}const W=zt();function Pt(){let r=k(null),e=k(null);const a=()=>O.data.find(v=>v.value==Z.current&&v.type=="segmentation"),n=()=>{if(a()){const v=a();t(e).setData(v.layer_data),t(e).options.layerOptions.color=Z.data.filter(l=>v.value==l.name)[0].color,t(r).eachLayer(l=>{l.annotationId===v.id&&t(r).removeLayer(l)})}},i=async()=>{var l;const v=(l=t(e))==null?void 0:l.getData();if(v)try{if(a()){const y=a();s(y.id)}const c=await O.createSegmentation(v,Z.current,S.current.id),o=L.geoJSON(v,{style:{color:Z.data.filter(y=>c.value==y.name)[0].color}});o.annotationId=c.id,t(r).addLayer(o),t(e).eraseAll()}catch(c){console.error("Error saving annotation:",c)}},s=v=>{t(r).eachLayer(l=>{l.annotationId===v&&(t(r).removeLayer(l),O.delete(v))}),O.delete(v)};return{initItems:v=>{t(r)?t(r).clearLayers():b(r,I(new L.FeatureGroup)),v.addLayer(t(r))},initControls:v=>{t(e)&&(t(e).stop(),v.removeControl(t(e))),b(e,I(L.control.paintPolygon({layerOptions:{color:Z.data.filter(l=>Z.current==l.name)[0].color}}))),v.addControl(t(e)),v.on("mousedown",n),v.on("mouseup",i)},addLayer:v=>{const l=L.geoJSON(v.layer_data,{style:{color:Z.data.filter(c=>v.value==c.name)[0].color}});l.annotationId=v.id,t(r).addLayer(l)},remove:v=>{t(e)&&(t(e).stop(),t(e).eraseAll(),v.removeControl(t(e)),v.off("mousedown",n),v.off("mouseup",i)),t(r)&&(v==null||v.removeLayer(t(r))),b(r,null),b(e,null)},removeLayer:s}}const U=Pt();function Tt(){let r=k(null),e=k(null),a=k(I([])),n,i;const s=()=>O.data.find(c=>c.value==Z.current&&c.type=="points"),f=async c=>{let o={};c.layers.eachLayer(y=>{const p=[y.getLatLng().lat,y.getLatLng().lng],B=t(a).findIndex(H=>H[0]===p[0]&&H[1]===p[1]);B>-1&&(t(a).splice(B,1),y.annotationId&&(o[y.annotationId]=!0))}),Object.keys(o).forEach(y=>{O.updatePoints(y,t(a))})},u=()=>{t(r).eachLayer(c=>{t(r).removeLayer(c)}),b(a,I([]))},_=async c=>{const{layer:o}=c;t(r).addLayer(o),s()?(t(a).push([o.getLatLng().lat,o.getLatLng().lng]),o.annotationId=O.data.find(y=>y.value==Z.current&&y.type=="points").id,O.updatePoints(o.annotationId,t(a))):(t(a).push([o.getLatLng().lat,o.getLatLng().lng]),await O.createPoints(t(a),Z.current,S.current.id))},v=c=>{t(r)?t(r).clearLayers():b(r,I(new L.FeatureGroup)),c.addLayer(t(r))};return{initItems:v,initControls:c=>{t(r)||v(c),n&&c.off(L.Draw.Event.CREATED,n),i&&c.off(L.Draw.Event.DELETED,i),t(e)&&c.removeControl(t(e)),b(e,I(new L.Control.Draw({position:"topright",edit:{featureGroup:t(r)},draw:{polyline:!1,circlemarker:!1,circle:!1,marker:{repeatMode:!0},rectangle:!1,polygon:!1}}))),c.addControl(t(e)),n=async o=>await _(o),i=async o=>await f(o),c.on(L.Draw.Event.CREATED,n),c.on(L.Draw.Event.DELETED,i)},deletePointsAnnotation:u,remove:c=>{t(r)&&(c==null||c.removeLayer(t(r))),t(e)&&(c==null||c.removeControl(t(e))),i&&c.off(L.Draw.Event.DELETED,i),n&&c.off(L.Draw.Event.CREATED,n),b(r,null),b(e,null),b(a,I([]))},addLayer:c=>{c.points.forEach(y=>{const p=L.marker(y);p.annotationId=c.id,t(r).addLayer(p)})}}}const q=Tt();function Ot(r,e){j(e,!0),G(async()=>{await fe(()=>import("../chunks/leaflet.draw.cJkf-kdY.js"),[],import.meta.url),await fe(()=>Promise.resolve({}),__vite__mapDeps([0]),import.meta.url);const a=await O.retrieve(S.current.id),n=T.map;U.remove(n),q.remove(n),W.initControls(n),W.initItems(T.map),a==null||a.forEach(i=>{i.type==="detection"&&W.addLayer(i)})}),Le(()=>{W.remove(T.map)}),F()}function Rt(r,e){j(e,!0),G(async()=>{await fe(()=>import("../chunks/Leaflet.PaintPolygon.BL41ABOh.js"),[],import.meta.url);const a=T.map;W.remove(a),q.remove(a),U.initControls(a),U.initItems(a);const n=await O.retrieve(S.current.id);n==null||n.forEach(i=>{i.type==="segmentation"&&U.addLayer(i)})}),Le(()=>{U.remove(T.map)}),F()}var Nt=M("<desc> </desc>"),Zt=M("<title> </title>"),jt=M('<svg><!><!><path d="M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C15.76,17.5 19.17,15.36 20.82,12C19.17,8.64 15.76,6.5 12,6.5C8.24,6.5 4.83,8.64 3.18,12Z"></path></svg>');function Ft(r,e){let a=d(e,"size",8,"1em"),n=d(e,"width",24,a),i=d(e,"height",24,a),s=d(e,"color",8,"currentColor"),f=d(e,"viewBox",8,"0 0 24 24"),u=d(e,"ariaLabel",24,()=>{}),_=d(e,"ariaHidden",24,()=>{}),v=d(e,"title",24,()=>{}),l=d(e,"desc",24,()=>{}),c=d(e,"class",24,()=>{});var o=jt(),y=m(o);A(y,l,H=>{var g=Nt(),x=m(g);h(g),D(()=>V(x,l())),E(H,g)});var p=C(y);A(p,v,H=>{var g=Zt(),x=m(g);h(g),D(()=>V(x,v())),E(H,g)});var B=C(p);h(o),D(()=>{w(o,"viewBox",f()),w(o,"width",n()),w(o,"height",i()),te(o,c()),w(o,"aria-label",u()),w(o,"aria-hidden",_()),w(B,"fill",s())}),E(r,o)}function Gt(r,e){j(e,!0),G(async()=>{await fe(()=>import("../chunks/leaflet.draw.cJkf-kdY.js"),[],import.meta.url),await fe(()=>Promise.resolve({}),__vite__mapDeps([0]),import.meta.url);const a=await O.retrieve(S.current.id),n=T.map;U.remove(n),W.remove(n),q.initControls(n),q.initItems(T.map),a==null||a.forEach(i=>{console.log(i),i.type==="points"&&q.addLayer(i)})}),Le(()=>{q.remove(T.map)}),F()}var Wt=P('<div class="w-[2px] h-[30px] bg-slate-500 self-center rounded-full"></div>');function We(r){var e=Wt();E(r,e)}const Ut=async(r,e,a)=>{if(e()){b(a,"classification");try{await O.createClassification(Z.current,S.current.id)}catch(n){console.error(n)}}},Jt=async(r,e,a)=>{e()&&b(a,"points")},qt=(r,e,a)=>{e()&&b(a,"detection")},Kt=(r,e,a)=>{e()&&b(a,"segmentation")},Qt=async(r,e)=>{b(e,null);const a=await O.retrieve(S.current.id);W.initItems(T.map),U.initItems(T.map),q.initItems(T.map),a==null||a.forEach(n=>{n.type==="detection"&&W.addLayer(n),n.type==="segmentation"&&U.addLayer(n),n.type==="points"&&q.addLayer(n)})};var Xt=P('<button data-tip="Points"><!></button>'),Yt=P('<button data-tip="Classification"><!></button> <button data-tip="Detection"><!></button> <button data-tip="Segmentation"><!></button> <button data-tip="See all annotations"><!></button> <!> <!> <!> <!> <!>',1);function $t(r,e){j(e,!0);let a=k(null);const n=()=>S.current?Z.current?!0:alert("Select label"):alert("Select image");var i=Yt(),s=Q(i);s.__click=[Ut,n,a];var f=m(s);dt(f,{size:"15"}),h(s);var u=C(s,2);u.__click=[qt,n,a];var _=m(u);bt(_,{size:"15"}),h(u);var v=C(u,2);v.__click=[Kt,n,a];var l=m(v);pt(l,{size:"15"}),h(v);var c=C(v,2);c.__click=[Qt,a];var o=m(c);Ft(o,{size:"15"}),h(c);var y=C(c,2);We(y);var p=C(y,2);A(p,()=>{var x;return((x=he.current)==null?void 0:x.task)=="SAM"},x=>{var N=Xt();N.__click=[Jt,n,a];var z=m(N);gt(z,{size:"15"}),h(N),D(()=>$(N,`btn ${(t(a)==="points"?"btn-primary":"btn-outline")??""} btn-sm tooltip tooltip-right flex items-center p-2`)),E(x,N)});var B=C(p,2);A(B,()=>t(a)==="detection",x=>{Ot(x,{})});var H=C(B,2);A(H,()=>t(a)==="segmentation",x=>{Rt(x,{})});var g=C(H,2);A(g,()=>t(a)==="points",x=>{Gt(x,{})}),D(()=>{$(s,`btn ${(t(a)==="classification"?"btn-primary":"btn-outline")??""} btn-sm tooltip tooltip-right flex items-center p-2`),$(u,`btn ${(t(a)==="detection"?"btn-primary":"btn-outline")??""} btn-sm tooltip flex items-center p-2`),$(v,`btn ${(t(a)==="segmentation"?"btn-primary":"btn-outline")??""} btn-sm tooltip flex items-center p-2`),$(c,`btn ${(t(a)===null?"btn-primary":"btn-outline")??""} btn-sm tooltip flex items-center p-2`)}),E(r,i),F()}we(["click"]);var ea=M("<desc> </desc>"),ta=M("<title> </title>"),aa=M('<svg><!><!><path d="M17.5 15.5C17.5 16.61 16.61 17.5 15.5 17.5S13.5 16.61 13.5 15.5 14.4 13.5 15.5 13.5 17.5 14.4 17.5 15.5M8.5 13.5C7.4 13.5 6.5 14.4 6.5 15.5S7.4 17.5 8.5 17.5 10.5 16.61 10.5 15.5 9.61 13.5 8.5 13.5M23 15V18C23 18.55 22.55 19 22 19H21V20C21 21.11 20.11 22 19 22H5C3.9 22 3 21.11 3 20V19H2C1.45 19 1 18.55 1 18V15C1 14.45 1.45 14 2 14H3C3 10.13 6.13 7 10 7H11V5.73C10.4 5.39 10 4.74 10 4C10 2.9 10.9 2 12 2S14 2.9 14 4C14 4.74 13.6 5.39 13 5.73V7H14C17.87 7 21 10.13 21 14H22C22.55 14 23 14.45 23 15M21 16H19V14C19 11.24 16.76 9 14 9H10C7.24 9 5 11.24 5 14V16H3V17H5V20H19V17H21V16Z"></path></svg>');function ra(r,e){let a=d(e,"size",8,"1em"),n=d(e,"width",24,a),i=d(e,"height",24,a),s=d(e,"color",8,"currentColor"),f=d(e,"viewBox",8,"0 0 24 24"),u=d(e,"ariaLabel",24,()=>{}),_=d(e,"ariaHidden",24,()=>{}),v=d(e,"title",24,()=>{}),l=d(e,"desc",24,()=>{}),c=d(e,"class",24,()=>{});var o=aa(),y=m(o);A(y,l,H=>{var g=ea(),x=m(g);h(g),D(()=>V(x,l())),E(H,g)});var p=C(y);A(p,v,H=>{var g=ta(),x=m(g);h(g),D(()=>V(x,v())),E(H,g)});var B=C(p);h(o),D(()=>{w(o,"viewBox",f()),w(o,"width",n()),w(o,"height",i()),te(o,c()),w(o,"aria-label",u()),w(o,"aria-hidden",_()),w(B,"fill",s())}),E(r,o)}const oa=async(r,e,a)=>{if(!S.current)return alert("Select image");if(!t(e))return alert("Select model");b(a,!0);try{const n=await he.inference(t(e),S.current.id);n==null||n.forEach(i=>{i.type==="detection"&&W.addLayer(i),i.type==="segmentation"&&U.addLayer(i)}),O.append(n),T.map.addLayer(L.geoJSON(n))}catch(n){console.error(n),alert(n)}finally{b(a,!1)}};var na=(r,e)=>he.retrieveOne(t(e)),ia=P("<option> </option>"),la=P('<select class="select select-sm"><option disabled>Select a model</option><!></select> <button class="flex items-center p-2 btn btn-sm tooltip btn-outline" data-tip="Run model inference"><!></button> <!>',1);function sa(r,e){j(e,!0);const a=Ae(),n=()=>ke(Ve,"$page",a);let i=k(null),s=k(!1);G(()=>{he.retrieve(n().params.campaign)});var f=_e(),u=Q(f);A(u,()=>{var _;return((_=he.data)==null?void 0:_.length)>0},_=>{var v=la(),l=Q(v);l.__change=[na,i];var c=m(l);c.value=(c.__value=null)==null?"":null;var o=C(c);me(o,17,()=>he.data,be,(H,g)=>{var x=ia(),N={},z=m(x);h(x),D(()=>{N!==(N=t(g).id)&&(x.value=(x.__value=t(g).id)==null?"":t(g).id),V(z,t(g).name)}),E(H,x)}),h(l);var y=C(l,2);y.__click=[oa,i,s];var p=m(y);ra(p,{size:"15"}),h(y);var B=C(y,2);We(B),D(()=>y.disabled=t(s)),et(l,()=>t(i),H=>b(i,H)),E(_,v)}),E(r,f),F()}we(["change","click"]);function ca(){let r=k(null),e=k(I([4,3,2])),a=k(I([0,4e3]));return{set showImageBBs(n){b(r,I(n)),localStorage.setItem("showImageBBs",n)},get showImageBBs(){return t(r)},set rgb(n){b(e,I(n)),localStorage.setItem("rgb",n)},get rgb(){return t(e)},set stretch(n){b(a,I(n)),localStorage.setItem("stretch",n)},get stretch(){return t(a)},init:()=>{b(r,localStorage.getItem("showImageBBs")==="true"),b(e,I(localStorage.getItem("rgb")?localStorage.getItem("rgb").split(",").map(Number):[4,3,2])),b(a,I(localStorage.getItem("stretch")?localStorage.getItem("stretch").split(",").map(Number):[0,4e3]))}}}const ee=ca();function da(){let r=k(null);return{initItems:e=>{t(r)?t(r).clearLayers():b(r,I(new L.FeatureGroup)),e.addLayer(t(r))},addBbox:(e,a)=>{let n=e.bbox;n=L.rectangle([[n[1],n[0]],[n[3],n[2]]],{interactive:!0,weight:10}),n.annotationId=e.path,n.on("click",()=>{a.fitBounds(n.getBounds()),S.current=e}),t(r).addLayer(n)},zoom:e=>{const a=t(r).getBounds();a.isValid()&&e.fitBounds(a)},toggle:e=>{ee.showImageBBs?(e.removeLayer(t(r)),ee.showImageBBs=!1):(e.addLayer(t(r)),ee.showImageBBs=!0)},hide:e=>{e==null||e.removeLayer(t(r))},remove:e=>{e==null||e.removeLayer(t(r))}}}const ue=da();var va=M("<desc> </desc>"),ua=M("<title> </title>"),fa=M('<svg><!><!><path d="M20,16V10H22V16A2,2 0 0,1 20,18H8C6.89,18 6,17.1 6,16V4C6,2.89 6.89,2 8,2H16V4H8V16H20M10.91,7.08L14,10.17L20.59,3.58L22,5L14,13L9.5,8.5L10.91,7.08M16,20V22H4A2,2 0 0,1 2,20V7H4V20H16Z"></path></svg>');function ga(r,e){let a=d(e,"size",8,"1em"),n=d(e,"width",24,a),i=d(e,"height",24,a),s=d(e,"color",8,"currentColor"),f=d(e,"viewBox",8,"0 0 24 24"),u=d(e,"ariaLabel",24,()=>{}),_=d(e,"ariaHidden",24,()=>{}),v=d(e,"title",24,()=>{}),l=d(e,"desc",24,()=>{}),c=d(e,"class",24,()=>{});var o=fa(),y=m(o);A(y,l,H=>{var g=va(),x=m(g);h(g),D(()=>V(x,l())),E(H,g)});var p=C(y);A(p,v,H=>{var g=ua(),x=m(g);h(g),D(()=>V(x,v())),E(H,g)});var B=C(p);h(o),D(()=>{w(o,"viewBox",f()),w(o,"width",n()),w(o,"height",i()),te(o,c()),w(o,"aria-label",u()),w(o,"aria-hidden",_()),w(B,"fill",s())}),E(r,o)}var _a=M("<desc> </desc>"),ha=M("<title> </title>"),ma=M('<svg><!><!><path d="M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22H20A2,2 0 0,0 22,20V12A10,10 0 0,0 12,2M13,7H11V11H7V13H11V17H13V13H17V11H13V7Z"></path></svg>');function ba(r,e){let a=d(e,"size",8,"1em"),n=d(e,"width",24,a),i=d(e,"height",24,a),s=d(e,"color",8,"currentColor"),f=d(e,"viewBox",8,"0 0 24 24"),u=d(e,"ariaLabel",24,()=>{}),_=d(e,"ariaHidden",24,()=>{}),v=d(e,"title",24,()=>{}),l=d(e,"desc",24,()=>{}),c=d(e,"class",24,()=>{});var o=ma(),y=m(o);A(y,l,H=>{var g=_a(),x=m(g);h(g),D(()=>V(x,l())),E(H,g)});var p=C(y);A(p,v,H=>{var g=ha(),x=m(g);h(g),D(()=>V(x,v())),E(H,g)});var B=C(p);h(o),D(()=>{w(o,"viewBox",f()),w(o,"width",n()),w(o,"height",i()),te(o,c()),w(o,"aria-label",u()),w(o,"aria-hidden",_()),w(B,"fill",s())}),E(r,o)}var wa=()=>ue.toggle(T.map),La=()=>ue.zoom(T.map),ya=P('<section class="flex flex-row gap-2"><span><button><!></button></span> <button class="btn btn-sm btn-outline tooltip tooltip-left flex items-center p-2" data-tip="Reset map"><!></button></section>');function pa(r,e){j(e,!0),G(()=>{ee.init()});var a=ya(),n=m(a),i=m(n);i.__click=[wa];var s=m(i);ga(s,{size:"15"}),h(i),h(n);var f=C(n,2);f.__click=[La];var u=m(f);ba(u,{size:"15"}),h(f),h(a),D(()=>{$(i,`btn btn-sm tooltip flex items-center p-2 ${(ee.showImageBBs?"btn-primary":"btn-outline")??""}`),w(i,"data-tip",`${(ee.showImageBBs?"Hide":"Show")??""} bbs`)}),E(r,a),F()}we(["click"]);var xa=P('<nav class="flex flex-row gap-2 bg-bg2 p-3 border-b border-t border-border justify-between"><span class="flex flex-row gap-2"><!> <!> <!></span> <span class="flex flex-row gap-2"><!></span></nav>');function Ca(r,e){j(e,!0);const a=Ae(),n=()=>ke(Ve,"$page",a);let i=k("");G(()=>{b(i,I(n().url.searchParams.get("id")))});var s=xa(),f=m(s),u=m(f);$t(u,{});var _=C(u,2);sa(_,{});var v=C(_,2),l=Fe(()=>`${X.url}/campaigns/export?id=${t(i)}`);at(v,{get link(){return t(l)}}),h(f);var c=C(f,2),o=m(c);pa(o,{}),h(c),h(s),E(r,s),F()}var Ea=P('<div id="map" class="svelte-g0bqmp"><!></div>');function Ha(r,e){j(e,!0);let a=k(null),n={attributionControl:!1,max_zoom:20};G(async()=>{var u;const f=await fe(()=>import("../chunks/leaflet-src.DTmlu4rB.js").then(_=>_.l),[],import.meta.url);return await fe(()=>Promise.resolve({}),__vite__mapDeps([1]),import.meta.url),b(a,I(f.map("map",n).setView(e.position,e.zoom))),t(a).zoomControl.setPosition("bottomright"),(u=e.panes)==null||u.forEach(({name:_,zIndex:v})=>{t(a).createPane(_),t(a).getPane(_).style.zIndex=v,t(a).getPane(_).style.pointerEvents="none"}),T.map=t(a),()=>t(a).remove()}),Xe("map",{getMap:()=>t(a)});var i=Ea(),s=m(i);rt(s,()=>e.children),h(i),E(r,i),F()}var Ia=P("<p>No annotations found</p>"),Ba=(r,e,a)=>e(t(a).id),Da=P('<tr class="h-8 hover:bg-slate-100"><td> </td><td> </td><td class="w-8"><button class="px-2 hover:text-red-600"><!></button></td></tr>'),Aa=P('<div class="flex-grow overflow-auto"><table class="table w-full"><thead><tr><th class="sticky top-0 text-left bg-bg2">Label</th><th class="sticky top-0 text-left bg-bg2">Type</th><th class="sticky top-0 bg-bg2"></th></tr></thead><tbody></tbody></table></div>'),ka=P('<section class="flex flex-col flex-1 h-full overflow-hidden"><!></section>');function Va(r,e){j(e,!1);const a=s=>{confirm("Are you sure you want to delete this annotation? This action is irreversible.")&&(O.delete(s),q.deletePointsAnnotation(s),W.removeLayer(s),U.removeLayer(s))};Ge();var n=ka(),i=m(n);A(i,()=>O.data.length==0,s=>{var f=Ia();E(s,f)},s=>{var f=Aa(),u=m(f),_=C(m(u));me(_,5,()=>O.data,be,(v,l)=>{var c=Da(),o=m(c),y=m(o);h(o);var p=C(o),B=m(p);h(p);var H=C(p),g=m(H);g.__click=[Ba,a,l];var x=m(g);tt(x,{size:"15"}),h(g),h(H),h(c),D(()=>{V(y,t(l).value),V(B,t(l).type)}),E(v,c)}),h(_),h(u),h(f),E(s,f)}),h(n),E(r,n),F()}we(["click"]);var R=it(()=>ee),Ma=P('<section class="flex flex-col flex-1 h-full overflow-hidden"><p> </p> <div class="flex flex-row gap-2"><input type="number"> <input type="number"> <input type="number"></div> <p> </p> <div class="flex flex-row gap-2"><input type="number"> <input type="number"></div></section>');function Sa(r,e){j(e,!1),Ge();var a=Ma(),n=m(a),i=m(n);D(()=>V(i,`RGB bands: ${R().rgb.join(", ")??""}`)),h(n);var s=C(n,2),f=m(s);ve(f),w(f,"min",0),w(f,"max",10),w(f,"step",1);var u=C(f,2);ve(u),w(u,"min",0),w(u,"max",10),w(u,"step",1);var _=C(u,2);ve(_),w(_,"min",0),w(_,"max",10),w(_,"step",1),h(s);var v=C(s,2),l=m(v);D(()=>V(l,`Stretch: ${R().stretch.join(", ")??""}`)),h(v);var c=C(v,2),o=m(c);ve(o),w(o,"min",0),w(o,"max",2**16),w(o,"step",1);var y=C(o,2);ve(y),w(y,"min",0),w(y,"max",2**16),w(y,"step",1),h(c),h(a),D(()=>{Ie(f,R().rgb[0]),Ie(u,R().rgb[1]),Ie(_,R().rgb[2]),Ie(o,R().stretch[0]),Ie(y,R().stretch[1])}),He("input",f,p=>{const B=[...R().rgb];B[0]=parseInt(p.target.value),R(R().rgb=B)}),He("input",u,p=>{const B=[...R().rgb];B[1]=parseInt(p.target.value),R(R().rgb=B)}),He("input",_,p=>{const B=[...R().rgb];B[2]=parseInt(p.target.value),R(R().rgb=B)}),He("input",o,p=>{const B=[...R().stretch];B[0]=parseInt(p.target.value),R(R().stretch=B)}),He("input",y,p=>{const B=[...R().stretch];B[1]=parseInt(p.target.value),R(R().stretch=B)}),E(r,a),F()}var za=M("<desc> </desc>"),Pa=M("<title> </title>"),Ta=M('<svg><!><!><path d="M6.1,10L4,18V8H21A2,2 0 0,0 19,6H12L10,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H19C19.9,20 20.7,19.4 20.9,18.5L23.2,10H6.1M19,18H6L7.6,12H20.6L19,18Z"></path></svg>');function Oa(r,e){let a=d(e,"size",8,"1em"),n=d(e,"width",24,a),i=d(e,"height",24,a),s=d(e,"color",8,"currentColor"),f=d(e,"viewBox",8,"0 0 24 24"),u=d(e,"ariaLabel",24,()=>{}),_=d(e,"ariaHidden",24,()=>{}),v=d(e,"title",24,()=>{}),l=d(e,"desc",24,()=>{}),c=d(e,"class",24,()=>{});var o=Ta(),y=m(o);A(y,l,H=>{var g=za(),x=m(g);h(g),D(()=>V(x,l())),E(H,g)});var p=C(y);A(p,v,H=>{var g=Pa(),x=m(g);h(g),D(()=>V(x,v())),E(H,g)});var B=C(p);h(o),D(()=>{w(o,"viewBox",f()),w(o,"width",n()),w(o,"height",i()),te(o,c()),w(o,"aria-label",u()),w(o,"aria-hidden",_()),w(B,"fill",s())}),E(r,o)}var Ra=M("<desc> </desc>"),Na=M("<title> </title>"),Za=M('<svg><!><!><path d="M19,19H5V5H19M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M13.96,12.29L11.21,15.83L9.25,13.47L6.5,17H17.5L13.96,12.29Z"></path></svg>');function ja(r,e){let a=d(e,"size",8,"1em"),n=d(e,"width",24,a),i=d(e,"height",24,a),s=d(e,"color",8,"currentColor"),f=d(e,"viewBox",8,"0 0 24 24"),u=d(e,"ariaLabel",24,()=>{}),_=d(e,"ariaHidden",24,()=>{}),v=d(e,"title",24,()=>{}),l=d(e,"desc",24,()=>{}),c=d(e,"class",24,()=>{});var o=Za(),y=m(o);A(y,l,H=>{var g=Ra(),x=m(g);h(g),D(()=>V(x,l())),E(H,g)});var p=C(y);A(p,v,H=>{var g=Na(),x=m(g);h(g),D(()=>V(x,v())),E(H,g)});var B=C(p);h(o),D(()=>{w(o,"viewBox",f()),w(o,"width",n()),w(o,"height",i()),te(o,c()),w(o,"aria-label",u()),w(o,"aria-hidden",_()),w(B,"fill",s())}),E(r,o)}var Fa=(r,e)=>e(""),Ga=(r,e,a)=>e(t(a)),Wa=P('<button class="text-nowrap hover:underline"> </button>'),Ua=(r,e,a)=>e(t(a)),Ja=P('<tr class="hover:bg-slate-100"><td><button class="flex hover:underline items-center gap-1 w-full"><!> </button></td></tr>'),qa=(r,e,a,n)=>e(t(a)[t(n)]),Ka=P('<tr><td class="pr-1"><button class="w-full"><p class="flex items-center gap-1 w-full"><!> </p></button></td></tr>'),Qa=P('<tr><th class="text-left"> </th><td class="pl-1"> </td></tr>'),Xa=P('<p> </p> <div class="overflow-auto flex-grow flex flex-col gap-2"><input type="text" placeholder="Search in folder ..." class="p-1 rounded-md input-sm w-full"> <div class="text-sm flex"><button class="text-nowrap hover:underline"></button> <!></div> <div class="overflow-auto flex-grow"><table class="w-full"><tbody><!></tbody></table></div></div>',1),Ya=P("<p>No files found.</p>"),$a=P("<p>Loading files ...</p>"),er=P('<div class="flex flex-col gap-2 h-full overflow-hidden"><!></div>');function tr(r,e){j(e,!0);const a=Ae(),n=()=>ke(Ve,"$page",a);let i=k(I({})),s=k(I([])),f=k(!1),u=k(I([])),_=k(!1),v=I({}),l=k(null);G(async()=>{S.retrieve(n().url.searchParams.get("id"))}),G(async()=>{b(f,!0),b(i,I({})),b(s,I([]));let z=c();b(i,I(z)),b(f,!1)}),Le(()=>{S.reset()});const c=()=>{const z={};return S.data.forEach(J=>{const ne=J.path.split(J.path.includes("\\")?"\\":"/");let ae=z;ne.forEach((re,ye)=>{ye==ne.length-1?ae[re]=J:(ae[re]||(ae[re]={}),ae=ae[re])})}),z},o=z=>{b(s,I([...t(s),t(i)])),b(i,I(t(i)[z])),H(z)},y=()=>{t(_)?(b(u,I(t(u).slice(0,t(u).length-1))),b(_,!1)):t(s).length>0&&(b(i,I(t(s).pop())),b(u,I(t(u).slice(0,t(u).length-1))))},p=z=>{const J=t(u).indexOf(z)+1;t(u).length>t(s).length&&z.split(".").length<2&&(b(_,!1),b(u,I(t(u).slice(0,t(u).length-1))));for(let ne=0;t(s).length-J>0;(ne+=1)-1)y()},B=z=>{S.current=z},H=z=>{t(s).length>0?b(u,I([...t(u),z])):b(u,I([]))};let g=Fe(()=>()=>t(l)?Object.keys(t(i)).filter(z=>z.toLowerCase().includes(t(l).toLowerCase())):Object.keys(t(i)));var x=er(),N=m(x);A(N,()=>!t(f),z=>{var J=_e(),ne=Q(J);A(ne,()=>S.data,ae=>{var re=Xa(),ye=Q(re),Ue=m(ye);h(ye);var Pe=C(ye,2),Me=m(Pe);ve(Me);var Se=C(Me,2),ze=m(Se);ze.__click=[Fa,p],ze.textContent="/";var Je=C(ze,2);me(Je,17,()=>t(u),be,(se,ie)=>{var le=Wa();le.__click=[Ga,p,ie];var pe=m(le);h(le),D(()=>V(pe,`${t(ie)??""}/`)),E(se,le)}),h(Se);var Te=C(Se,2),Oe=m(Te),Re=m(Oe),qe=m(Re);A(qe,()=>t(_)==!1,se=>{var ie=_e(),le=Q(ie);me(le,17,()=>t(g)(),be,(pe,Y)=>{var ge=_e(),xe=Q(ge);A(xe,()=>typeof t(i)[t(Y)]=="object"&&!t(i)[t(Y)].id,Ce=>{var K=Ja(),ce=m(K),de=m(ce);de.__click=[Ua,o,Y];var Ee=m(de);Oa(Ee,{size:"15"});var Be=C(Ee,1,!0);h(de),h(ce),h(K),D(()=>V(Be,t(Y))),E(Ce,K)},Ce=>{var K=Ka(),ce=m(K),de=m(ce);de.__click=[qa,B,i,Y];var Ee=m(de),Be=m(Ee);ja(Be,{size:"15"});var Ke=C(Be,1,!0);h(Ee),h(de),h(ce),h(K),D(()=>{var Ne,Ze;$(K,`hover:bg-slate-100 ${(((Ne=S.current)==null?void 0:Ne.id)==((Ze=t(i)[t(Y)])==null?void 0:Ze.id)?"bg-slate-100":"")??""}`),V(Ke,t(Y))}),E(Ce,K)}),E(pe,ge)}),E(se,ie)},se=>{var ie=_e(),le=Q(ie);me(le,17,()=>Object.keys(v),be,(pe,Y)=>{var ge=Qa(),xe=m(ge),Ce=m(xe);h(xe);var K=C(xe),ce=m(K);h(K),h(ge),D(()=>{V(Ce,`${t(Y)??""}:`),V(ce,v[t(Y)])}),E(pe,ge)}),E(se,ie)}),h(Re),h(Oe),h(Te),h(Pe),D(()=>V(Ue,`Images (${S.data.length??""}) :`)),ot(Me,()=>t(l),se=>b(l,se)),E(ae,re)},ae=>{var re=Ya();E(ae,re)}),E(z,J)},z=>{var J=$a();E(z,J)}),h(x),E(r,x),F()}we(["click"]);var ar=(r,e)=>b(e,"labels"),rr=(r,e)=>b(e,"annotations"),or=(r,e)=>b(e,"settings"),nr=P('<div class="flex flex-col p-3 border-l bg-bg2 border-border w-[300px] h-full justify-between"><div class="h-[250px]"><!></div> <div class="flex flex-col flex-1 h-full"><div class="w-full h-[2px] bg-slate-500 rounded-full my-2"></div> <span class="flex gap-4"><button>Labels</button> <button>Annotations</button> <button>Settings</button></span> <!> <!> <!></div></div>');function ir(r,e){j(e,!0);let a=k("labels");G(async()=>{if(S.current){const p=await O.retrieve(S.current.id);W.initItems(T.map),U.initItems(T.map),q.initItems(T.map),p==null||p.forEach(B=>{B.type==="detection"&&W.addLayer(B),B.type==="segmentation"&&U.addLayer(B),B.type==="points"&&q.addLayer(B)})}}),Le(()=>{Z.reset(),W.remove(T.map),U.remove(T.map),q.remove(T.map),O.reset()});var n=nr(),i=m(n),s=m(i);tr(s,{}),h(i);var f=C(i,2),u=C(m(f),2),_=m(u);_.__click=[ar,a];var v=C(_,2);v.__click=[rr,a];var l=C(v,2);l.__click=[or,a],h(u);var c=C(u,2);A(c,()=>t(a)==="labels",p=>{$e(p,{})});var o=C(c,2);A(o,()=>t(a)==="annotations",p=>{Va(p,{})});var y=C(o,2);A(y,()=>t(a)==="settings",p=>{Sa(p,{})}),h(f),h(n),D(()=>{$(_,`pb-1 ${(t(a)==="labels"?"border-b-2 border-primary":"")??""}`),$(v,`pb-1 ${(t(a)==="annotations"?"border-b-2 border-primary":"")??""}`),$(l,`pb-1 ${(t(a)==="settings"?"border-b-2 border-primary":"")??""}`)}),E(r,n),F()}we(["click"]);function je(r,e){j(e,!0);const{getMap:a}=Ye("map");let n=null;G(()=>{const i=a();return i&&(n=L.tileLayer(e.url,e.options).addTo(i)),()=>n==null?void 0:n.remove()}),F()}var lr=P('<label class="svelte-u9pskg"><input type="radio" name="layers"> </label>'),sr=P('<form class="svelte-u9pskg"></form>');function cr(r,e){const a=[];let n=d(e,"layers",19,()=>["streets","satellite"]),i=d(e,"layer",15);var s=sr();me(s,21,n,be,(f,u)=>{var _=lr(),v=m(_);ve(v);var l,c=C(v);h(_),D(()=>{l!==(l=t(u))&&(v.value=(v.__value=t(u))==null?"":t(u)),V(c,` ${t(u)??""}`)}),nt(a,[],v,()=>(t(u),i()),i),E(f,_)}),h(s),E(r,s)}function dr(r,e){j(e,!0);let a=d(e,"palette",3,"viridis"),n=k(null),i=k(!1);G(()=>{const s=T.map;s&&(t(i)||(ue.initItems(s),S.data.forEach(f=>{ue.addBbox(f,s)}),ue.zoom(s)),ee.showImageBBs||ue.hide(s),S.data.length>0&&b(i,!0))}),G(()=>{const s=T.map;if(s&&S.current){S.zoom(S.current.bbox,s);let f=`${X.api_url}/images/${De.current.path}/${S.current.path}/{z}/{x}/{y}.png?stretch=${ee.stretch}&bands=${ee.rgb}&palette=${a()}`;De.current.eotdlDatasetId&&(f+=`&eotdlDatasetId=${De.current.eotdlDatasetId}`),t(n)?t(n).setUrl(f):b(n,I(L.tileLayer(f,e.options).addTo(s)))}}),Le(()=>{ue.remove(T.map),b(i,!1)}),F()}var vr=P("<!> <!>",1),ur=P('<div class="flex flex-col flex-1 h-full"><!> <div class="flex flex-row flex-1 w-full h-full"><div class="flex-1"><!></div> <div class="w-[300px]"><!></div></div></div> <!>',1);function Pr(r,e){j(e,!0);const a=Ae(),n=()=>ke(Ve,"$page",a);let i=k("streets");G(()=>{De.retrieveOne(n().url.searchParams.get("id"))});var s=ur(),f=Q(s),u=m(f);Ca(u,{});var _=C(u,2),v=m(_),l=m(v);Ha(l,{position:[42.0407,3.1],zoom:4,children:(p,B)=>{var H=vr(),g=Q(H);A(g,()=>t(i)=="streets",N=>{je(N,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{maxZoom:40,zIndex:1}})},N=>{var z=_e(),J=Q(z);A(J,()=>t(i)=="satellite",ne=>{je(ne,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{maxZoom:40,zIndex:1}})},null,!0),E(N,z)});var x=C(g,2);cr(x,{layers:["streets","satellite"],get layer(){return t(i)},set layer(N){b(i,I(N))}}),E(p,H)},$$slots:{default:!0}}),h(v);var c=C(v,2),o=m(c);ir(o,{}),h(c),h(_),h(f);var y=C(f,2);A(y,()=>S.data,p=>{dr(p,{options:{maxZoom:20,zIndex:2}})}),E(r,s),F()}export{Pr as component};
