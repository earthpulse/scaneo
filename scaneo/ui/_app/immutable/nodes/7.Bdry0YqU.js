const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../assets/leaflet.GL2v8lVq.css","../assets/leaflet.jCI8mrZJ.css"])))=>i.map(i=>d[i]);
import{a as m,n as D,t as S,c as de}from"../chunks/disclose-version.DHz0PKsI.js";import{t as V,c as u,s as H,r as v,g as t,o as B,N as T,p as F,u as Z,a as j,f as W,aE as Re,d as Ze,aF as Fe}from"../chunks/runtime.B6coxiGD.js";import{i as E}from"../chunks/if.PCbA7Ql5.js";import{p as z}from"../chunks/proxy.BT_Zq6Rg.js";import{s as pe,a as Be,p as Ve}from"../chunks/stores.B0ZJM6wJ.js";import{d as ue}from"../chunks/events.aoiNrylR.js";import{a as Y,s as ae}from"../chunks/class.5UNJRUNG.js";import{s as k}from"../chunks/render.PYmPAuDm.js";import{s as b,r as Se}from"../chunks/attributes.aUdXhcos.js";import{p as n}from"../chunks/props.Bsy5QBFU.js";import{_ as be,a as we}from"../chunks/preload-helper.D8W-vDLt.js";import{a as P,i as A}from"../chunks/images.svelte.DdjF-flN.js";import{l as N,L as je}from"../chunks/Labels.BQ_UFHTQ.js";import{e as ce,i as ve}from"../chunks/each.Czia2JB_.js";import{b as Ge,D as We}from"../chunks/DeleteOutline.D--ZWbtp.js";import{m as xe}from"../chunks/models.svelte.CU4x2gqc.js";import{s as Je}from"../chunks/snippet.NRoO2-QE.js";import{i as Ue}from"../chunks/lifecycle.3-Snn6Zk.js";import{b as qe,a as Ke}from"../chunks/input.DJnXoNif.js";import{P as Qe}from"../chunks/fetcher.BMDzGJ_8.js";import{c as ye}from"../chunks/campaigns.svelte.2R2DxKnQ.js";var Xe=D("<desc> </desc>"),Ye=D("<title> </title>"),$e=D('<svg><!><!><path d="M12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5M12,2A7,7 0 0,1 19,9C19,14.25 12,22 12,22C12,22 5,14.25 5,9A7,7 0 0,1 12,2M12,4A5,5 0 0,0 7,9C7,10 7,12 12,18.71C17,12 17,10 17,9A5,5 0 0,0 12,4Z"></path></svg>');function et(o,e){let r=n(e,"size",8,"1em"),i=n(e,"width",24,r),c=n(e,"height",24,r),h=n(e,"color",8,"currentColor"),w=n(e,"viewBox",8,"0 0 24 24"),f=n(e,"ariaLabel",24,()=>{}),g=n(e,"ariaHidden",24,()=>{}),s=n(e,"title",24,()=>{}),l=n(e,"desc",24,()=>{}),_=n(e,"class",24,()=>{});var a=$e(),x=u(a);E(x,l,C=>{var d=Xe(),y=u(d);v(d),V(()=>k(y,l())),m(C,d)});var p=H(x);E(p,s,C=>{var d=Ye(),y=u(d);v(d),V(()=>k(y,s())),m(C,d)});var I=H(p);v(a),V(()=>{b(a,"viewBox",w()),b(a,"width",i()),b(a,"height",c()),Y(a,_()),b(a,"aria-label",f()),b(a,"aria-hidden",g()),b(I,"fill",h())}),m(o,a)}var tt=D("<desc> </desc>"),at=D("<title> </title>"),rt=D('<svg><!><!><path d="M5,3C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19H5V5H12V3H5M17.78,4C17.61,4 17.43,4.07 17.3,4.2L16.08,5.41L18.58,7.91L19.8,6.7C20.06,6.44 20.06,6 19.8,5.75L18.25,4.2C18.12,4.07 17.95,4 17.78,4M15.37,6.12L8,13.5V16H10.5L17.87,8.62L15.37,6.12Z"></path></svg>');function ot(o,e){let r=n(e,"size",8,"1em"),i=n(e,"width",24,r),c=n(e,"height",24,r),h=n(e,"color",8,"currentColor"),w=n(e,"viewBox",8,"0 0 24 24"),f=n(e,"ariaLabel",24,()=>{}),g=n(e,"ariaHidden",24,()=>{}),s=n(e,"title",24,()=>{}),l=n(e,"desc",24,()=>{}),_=n(e,"class",24,()=>{});var a=rt(),x=u(a);E(x,l,C=>{var d=tt(),y=u(d);v(d),V(()=>k(y,l())),m(C,d)});var p=H(x);E(p,s,C=>{var d=at(),y=u(d);v(d),V(()=>k(y,s())),m(C,d)});var I=H(p);v(a),V(()=>{b(a,"viewBox",w()),b(a,"width",i()),b(a,"height",c()),Y(a,_()),b(a,"aria-label",f()),b(a,"aria-hidden",g()),b(I,"fill",h())}),m(o,a)}var lt=D("<desc> </desc>"),it=D("<title> </title>"),nt=D('<svg><!><!><path d="M2,2V8H4.28L5.57,16H4V22H10V20.06L15,20.05V22H21V16H19.17L20,9H22V3H16V6.53L14.8,8H9.59L8,5.82V2M4,4H6V6H4M18,5H20V7H18M6.31,8H7.11L9,10.59V14H15V10.91L16.57,9H18L17.16,16H15V18.06H10V16H7.6M11,10H13V12H11M6,18H8V20H6M17,18H19V20H17"></path></svg>');function st(o,e){let r=n(e,"size",8,"1em"),i=n(e,"width",24,r),c=n(e,"height",24,r),h=n(e,"color",8,"currentColor"),w=n(e,"viewBox",8,"0 0 24 24"),f=n(e,"ariaLabel",24,()=>{}),g=n(e,"ariaHidden",24,()=>{}),s=n(e,"title",24,()=>{}),l=n(e,"desc",24,()=>{}),_=n(e,"class",24,()=>{});var a=nt(),x=u(a);E(x,l,C=>{var d=lt(),y=u(d);v(d),V(()=>k(y,l())),m(C,d)});var p=H(x);E(p,s,C=>{var d=it(),y=u(d);v(d),V(()=>k(y,s())),m(C,d)});var I=H(p);v(a),V(()=>{b(a,"viewBox",w()),b(a,"width",i()),b(a,"height",c()),Y(a,_()),b(a,"aria-label",f()),b(a,"aria-hidden",g()),b(I,"fill",h())}),m(o,a)}function dt(){let o=T(null);return{get map(){return t(o)},set map(e){B(o,z(e))}}}const O=dt();function ct(){let o=T(null),e=T(null),r,i,c;const h=async l=>{const{layer:_}=l,a=_.getBounds(),x=await P.createDetection([[a._southWest.lat,a._northEast.lng],[a._northEast.lat,a._southWest.lng]],N.current,A.current.id);_.options.color=N.data.filter(p=>x.value==p.name)[0].color,console.log("data",x),_.annotationId=x.id,t(o).addLayer(_)},w=l=>{console.log("editCallback"),l.layers.eachLayer(_=>{const a=_.getBounds();P.updateDetection(_.annotationId,[[a._southWest.lat,a._northEast.lng],[a._northEast.lat,a._southWest.lng]])})},f=l=>{l.layers.eachLayer(_=>{P.delete(_.annotationId)})},g=l=>{t(o)?t(o).clearLayers():B(o,z(new L.FeatureGroup)),l.addLayer(t(o))};return{initItems:g,initControls:l=>{t(o)||g(l),r&&l.off(L.Draw.Event.CREATED,r),i&&l.off(L.Draw.Event.EDITED,i),c&&l.off(L.Draw.Event.DELETED,c),t(e)&&l.removeControl(t(e)),B(e,z(new L.Control.Draw({position:"topright",edit:{featureGroup:t(o)},draw:{polyline:!1,circlemarker:!1,circle:!1,marker:!1,rectangle:{repeatMode:!0,showArea:!1,showLength:!0,shapeOptions:{weight:1}},polygon:!1}}))),l.addControl(t(e)),r=async _=>await h(_),i=w,c=f,l.on(L.Draw.Event.CREATED,r),l.on(L.Draw.Event.EDITED,i),l.on(L.Draw.Event.DELETED,c)},remove:l=>{t(o)&&(l==null||l.removeLayer(t(o))),t(e)&&(l==null||l.removeControl(t(e))),r&&l.off(L.Draw.Event.CREATED,r),i&&l.off(L.Draw.Event.EDITED,i),c&&l.off(L.Draw.Event.DELETED,c),B(o,null),B(e,null)},addLayer:l=>{const _=l.bb,a=L.rectangle([[_[0][0],_[0][1]],[_[1][0],_[1][1]]],{editing:!0});a.options.color=N.data.filter(x=>l.value==x.name)[0].color,a.annotationId=l.id,t(o).addLayer(a)},removeLayer:l=>{t(o).eachLayer(_=>{_.annotationId===l&&t(o).removeLayer(_)})}}}const J=ct();function vt(){let o=T(null),e=T(null);const r=()=>P.data.find(s=>s.value==N.current&&s.type=="segmentation"),i=()=>{if(r()){const s=r();t(e).setData(s.layer_data),t(e).options.layerOptions.color=N.data.filter(l=>s.value==l.name)[0].color,t(o).eachLayer(l=>{l.annotationId===s.id&&t(o).removeLayer(l)})}},c=async()=>{var l;const s=(l=t(e))==null?void 0:l.getData();if(s)try{if(r()){const x=r();h(x.id)}const _=await P.createSegmentation(s,N.current,A.current.id),a=L.geoJSON(s,{style:{color:N.data.filter(x=>_.value==x.name)[0].color}});a.annotationId=_.id,t(o).addLayer(a),t(e).eraseAll()}catch(_){console.error("Error saving annotation:",_)}},h=s=>{t(o).eachLayer(l=>{l.annotationId===s&&(t(o).removeLayer(l),P.delete(s))}),P.delete(s)};return{initItems:s=>{t(o)?t(o).clearLayers():B(o,z(new L.FeatureGroup)),s.addLayer(t(o))},initControls:s=>{t(e)&&(t(e).stop(),s.removeControl(t(e))),B(e,z(L.control.paintPolygon({layerOptions:{color:N.data.filter(l=>N.current==l.name)[0].color}}))),s.addControl(t(e)),s.on("mousedown",i),s.on("mouseup",c)},addLayer:s=>{const l=L.geoJSON(s.layer_data,{style:{color:N.data.filter(_=>s.value==_.name)[0].color}});l.annotationId=s.id,t(o).addLayer(l)},remove:s=>{t(e)&&(t(e).stop(),t(e).eraseAll(),s.removeControl(t(e)),s.off("mousedown",i),s.off("mouseup",c)),t(o)&&(s==null||s.removeLayer(t(o))),B(o,null),B(e,null)},removeLayer:h}}const U=vt();function ut(o,e){F(e,!0),Z(async()=>{await be(()=>import("../chunks/leaflet.draw.cJkf-kdY.js"),[],import.meta.url),await be(()=>Promise.resolve({}),__vite__mapDeps([0]),import.meta.url);const r=await P.retrieve(A.current.id),i=O.map;U.remove(i),J.initControls(i),J.initItems(O.map),r==null||r.forEach(c=>{c.type==="detection"&&J.addLayer(c)})}),we(()=>{J.remove(O.map)}),j()}function ft(o,e){F(e,!0),Z(async()=>{await be(()=>import("../chunks/Leaflet.PaintPolygon.BL41ABOh.js"),[],import.meta.url);const r=O.map;J.remove(r),U.initControls(r),U.initItems(r);const i=await P.retrieve(A.current.id);i==null||i.forEach(c=>{c.type==="segmentation"&&U.addLayer(c)})}),we(()=>{U.remove(O.map)}),j()}var _t=D("<desc> </desc>"),ht=D("<title> </title>"),gt=D('<svg><!><!><path d="M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C15.76,17.5 19.17,15.36 20.82,12C19.17,8.64 15.76,6.5 12,6.5C8.24,6.5 4.83,8.64 3.18,12Z"></path></svg>');function mt(o,e){let r=n(e,"size",8,"1em"),i=n(e,"width",24,r),c=n(e,"height",24,r),h=n(e,"color",8,"currentColor"),w=n(e,"viewBox",8,"0 0 24 24"),f=n(e,"ariaLabel",24,()=>{}),g=n(e,"ariaHidden",24,()=>{}),s=n(e,"title",24,()=>{}),l=n(e,"desc",24,()=>{}),_=n(e,"class",24,()=>{});var a=gt(),x=u(a);E(x,l,C=>{var d=_t(),y=u(d);v(d),V(()=>k(y,l())),m(C,d)});var p=H(x);E(p,s,C=>{var d=ht(),y=u(d);v(d),V(()=>k(y,s())),m(C,d)});var I=H(p);v(a),V(()=>{b(a,"viewBox",w()),b(a,"width",i()),b(a,"height",c()),Y(a,_()),b(a,"aria-label",f()),b(a,"aria-hidden",g()),b(I,"fill",h())}),m(o,a)}const bt=async(o,e,r)=>{if(e()){B(r,"classification");try{await P.createClassification(N.current,A.current.id)}catch(i){console.error(i)}}},wt=(o,e,r)=>{e()&&B(r,"detection")},Lt=(o,e,r)=>{e()&&B(r,"segmentation")},xt=async(o,e)=>{B(e,null);const r=await P.retrieve(A.current.id);J.initItems(O.map),U.initItems(O.map),r==null||r.forEach(i=>{i.type==="detection"&&J.addLayer(i),i.type==="segmentation"&&U.addLayer(i)})};var yt=S('<button data-tip="Classification"><!></button> <button data-tip="Detection"><!></button> <button data-tip="Segmentation"><!></button> <button data-tip="See all annotations"><!></button> <!> <!>',1);function Ht(o,e){F(e,!0);let r=T(null);const i=()=>A.current?N.current?!0:alert("Select label"):alert("Select image");var c=yt(),h=W(c);h.__click=[bt,i,r];var w=u(h);et(w,{size:"15"}),v(h);var f=H(h,2);f.__click=[wt,i,r];var g=u(f);ot(g,{size:"15"}),v(f);var s=H(f,2);s.__click=[Lt,i,r];var l=u(s);st(l,{size:"15"}),v(s);var _=H(s,2);_.__click=[xt,r];var a=u(_);mt(a,{size:"15"}),v(_);var x=H(_,2);E(x,()=>t(r)==="detection",I=>{ut(I,{})});var p=H(x,2);E(p,()=>t(r)==="segmentation",I=>{ft(I,{})}),V(()=>{ae(h,`btn ${(t(r)==="classification"?"btn-primary":"btn-outline")??""} btn-sm tooltip tooltip-right flex items-center p-2`),ae(f,`btn ${(t(r)==="detection"?"btn-primary":"btn-outline")??""} btn-sm tooltip flex items-center p-2`),ae(s,`btn ${(t(r)==="segmentation"?"btn-primary":"btn-outline")??""} btn-sm tooltip flex items-center p-2`),ae(_,`btn ${(t(r)===null?"btn-primary":"btn-outline")??""} btn-sm tooltip flex items-center p-2`)}),m(o,c),j()}ue(["click"]);var Ct=D("<desc> </desc>"),pt=D("<title> </title>"),Bt=D('<svg><!><!><path d="M17.5 15.5C17.5 16.61 16.61 17.5 15.5 17.5S13.5 16.61 13.5 15.5 14.4 13.5 15.5 13.5 17.5 14.4 17.5 15.5M8.5 13.5C7.4 13.5 6.5 14.4 6.5 15.5S7.4 17.5 8.5 17.5 10.5 16.61 10.5 15.5 9.61 13.5 8.5 13.5M23 15V18C23 18.55 22.55 19 22 19H21V20C21 21.11 20.11 22 19 22H5C3.9 22 3 21.11 3 20V19H2C1.45 19 1 18.55 1 18V15C1 14.45 1.45 14 2 14H3C3 10.13 6.13 7 10 7H11V5.73C10.4 5.39 10 4.74 10 4C10 2.9 10.9 2 12 2S14 2.9 14 4C14 4.74 13.6 5.39 13 5.73V7H14C17.87 7 21 10.13 21 14H22C22.55 14 23 14.45 23 15M21 16H19V14C19 11.24 16.76 9 14 9H10C7.24 9 5 11.24 5 14V16H3V17H5V20H19V17H21V16Z"></path></svg>');function Vt(o,e){let r=n(e,"size",8,"1em"),i=n(e,"width",24,r),c=n(e,"height",24,r),h=n(e,"color",8,"currentColor"),w=n(e,"viewBox",8,"0 0 24 24"),f=n(e,"ariaLabel",24,()=>{}),g=n(e,"ariaHidden",24,()=>{}),s=n(e,"title",24,()=>{}),l=n(e,"desc",24,()=>{}),_=n(e,"class",24,()=>{});var a=Bt(),x=u(a);E(x,l,C=>{var d=Ct(),y=u(d);v(d),V(()=>k(y,l())),m(C,d)});var p=H(x);E(p,s,C=>{var d=pt(),y=u(d);v(d),V(()=>k(y,s())),m(C,d)});var I=H(p);v(a),V(()=>{b(a,"viewBox",w()),b(a,"width",i()),b(a,"height",c()),Y(a,_()),b(a,"aria-label",f()),b(a,"aria-hidden",g()),b(I,"fill",h())}),m(o,a)}var Et=S('<div class="w-[2px] h-[30px] bg-slate-500 self-center rounded-full"></div>');function It(o){var e=Et();m(o,e)}const kt=async(o,e,r)=>{if(!A.current)return alert("Select image");if(!t(e))return alert("Select model");B(r,!0);try{console.log(t(e));const i=await xe.inference(t(e),A.current.id);console.log(i),O.map.addLayer(L.geoJSON(i))}catch(i){console.error(i),alert(i)}finally{B(r,!1)}};var Dt=S("<option> </option>"),At=S('<!> <select class="select select-sm"><option disabled>Select a model</option><!></select> <button class="btn btn-sm tooltip flex items-center p-2 btn-outline" data-tip="Run model inference"><!></button>',1);function Mt(o,e){F(e,!0);const r=pe(),i=()=>Be(Ve,"$page",r);let c=T(null),h=T(!1);Z(()=>{xe.retrieve(i().params.campaign)});var w=de(),f=W(w);E(f,()=>{var g;return((g=xe.data)==null?void 0:g.length)>0},g=>{var s=At(),l=W(s);It(l);var _=H(l,2),a=u(_);a.value=(a.__value=null)==null?"":null;var x=H(a);ce(x,17,()=>xe.data,ve,(C,d)=>{var y=Dt(),q={},M=u(y);v(y),V(()=>{q!==(q=t(d).id)&&(y.value=(y.__value=t(d).id)==null?"":t(d).id),k(M,t(d).name)}),m(C,y)}),v(_);var p=H(_,2);p.__click=[kt,c,h];var I=u(p);Vt(I,{size:"15"}),v(p),V(()=>p.disabled=t(h)),Ge(_,()=>t(c),C=>B(c,C)),m(g,s)}),m(o,w),j()}ue(["click"]);function zt(){let o=T(null);return{set showImageBBs(e){B(o,z(e)),localStorage.setItem("showImageBBs",e)},get showImageBBs(){return t(o)},init:()=>{B(o,localStorage.getItem("showImageBBs")==="true")}}}const ne=zt();function St(){let o=T(null);return{initItems:e=>{t(o)?t(o).clearLayers():B(o,z(new L.FeatureGroup)),e.addLayer(t(o))},addBbox:(e,r)=>{let i=JSON.parse(e.bbox);i=L.rectangle([[i[1],i[0]],[i[3],i[2]]],{interactive:!0,weight:10}),i.annotationId=e.path,i.on("click",()=>{r.fitBounds(i.getBounds()),A.current=e}),t(o).addLayer(i)},zoom:e=>{const r=t(o).getBounds();r.isValid()&&e.fitBounds(r)},toggle:e=>{ne.showImageBBs?(e.removeLayer(t(o)),ne.showImageBBs=!1):(e.addLayer(t(o)),ne.showImageBBs=!0)},hide:e=>{e==null||e.removeLayer(t(o))},remove:e=>{e==null||e.removeLayer(t(o))}}}const ie=St();var Tt=D("<desc> </desc>"),Ot=D("<title> </title>"),Pt=D('<svg><!><!><path d="M20,16V10H22V16A2,2 0 0,1 20,18H8C6.89,18 6,17.1 6,16V4C6,2.89 6.89,2 8,2H16V4H8V16H20M10.91,7.08L14,10.17L20.59,3.58L22,5L14,13L9.5,8.5L10.91,7.08M16,20V22H4A2,2 0 0,1 2,20V7H4V20H16Z"></path></svg>');function Nt(o,e){let r=n(e,"size",8,"1em"),i=n(e,"width",24,r),c=n(e,"height",24,r),h=n(e,"color",8,"currentColor"),w=n(e,"viewBox",8,"0 0 24 24"),f=n(e,"ariaLabel",24,()=>{}),g=n(e,"ariaHidden",24,()=>{}),s=n(e,"title",24,()=>{}),l=n(e,"desc",24,()=>{}),_=n(e,"class",24,()=>{});var a=Pt(),x=u(a);E(x,l,C=>{var d=Tt(),y=u(d);v(d),V(()=>k(y,l())),m(C,d)});var p=H(x);E(p,s,C=>{var d=Ot(),y=u(d);v(d),V(()=>k(y,s())),m(C,d)});var I=H(p);v(a),V(()=>{b(a,"viewBox",w()),b(a,"width",i()),b(a,"height",c()),Y(a,_()),b(a,"aria-label",f()),b(a,"aria-hidden",g()),b(I,"fill",h())}),m(o,a)}var Rt=D("<desc> </desc>"),Zt=D("<title> </title>"),Ft=D('<svg><!><!><path d="M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22H20A2,2 0 0,0 22,20V12A10,10 0 0,0 12,2M13,7H11V11H7V13H11V17H13V13H17V11H13V7Z"></path></svg>');function jt(o,e){let r=n(e,"size",8,"1em"),i=n(e,"width",24,r),c=n(e,"height",24,r),h=n(e,"color",8,"currentColor"),w=n(e,"viewBox",8,"0 0 24 24"),f=n(e,"ariaLabel",24,()=>{}),g=n(e,"ariaHidden",24,()=>{}),s=n(e,"title",24,()=>{}),l=n(e,"desc",24,()=>{}),_=n(e,"class",24,()=>{});var a=Ft(),x=u(a);E(x,l,C=>{var d=Rt(),y=u(d);v(d),V(()=>k(y,l())),m(C,d)});var p=H(x);E(p,s,C=>{var d=Zt(),y=u(d);v(d),V(()=>k(y,s())),m(C,d)});var I=H(p);v(a),V(()=>{b(a,"viewBox",w()),b(a,"width",i()),b(a,"height",c()),Y(a,_()),b(a,"aria-label",f()),b(a,"aria-hidden",g()),b(I,"fill",h())}),m(o,a)}var Gt=()=>ie.toggle(O.map),Wt=()=>ie.zoom(O.map),Jt=S('<section class="flex flex-row gap-2"><span><button><!></button></span> <button class="btn btn-sm btn-outline tooltip tooltip-left flex items-center p-2" data-tip="Reset map"><!></button></section>');function Ut(o,e){F(e,!0),Z(()=>{ne.init()});var r=Jt(),i=u(r),c=u(i);c.__click=[Gt];var h=u(c);Nt(h,{size:"15"}),v(c),v(i);var w=H(i,2);w.__click=[Wt];var f=u(w);jt(f,{size:"15"}),v(w),v(r),V(()=>{ae(c,`btn btn-sm tooltip flex items-center p-2 ${(ne.showImageBBs?"btn-primary":"btn-outline")??""}`),b(c,"data-tip",`${(ne.showImageBBs?"Hide":"Show")??""} bbs`)}),m(o,r),j()}ue(["click"]);var qt=S('<nav class="flex flex-row gap-2 bg-bg2 p-3 border-b border-t border-border justify-between"><span class="flex flex-row gap-2"><!> <!></span> <!></nav>');function Kt(o){var e=qt(),r=u(e),i=u(r);Ht(i,{});var c=H(i,2);Mt(c,{}),v(r);var h=H(r,2);Ut(h,{}),v(e),m(o,e)}var Qt=S('<div id="map" class="svelte-g0bqmp"><!></div>');function Xt(o,e){F(e,!0);let r=T(null),i={attributionControl:!1,max_zoom:20};Z(async()=>{var f;const w=await be(()=>import("../chunks/leaflet-src.DTmlu4rB.js").then(g=>g.l),[],import.meta.url);return await be(()=>Promise.resolve({}),__vite__mapDeps([1]),import.meta.url),B(r,z(w.map("map",i).setView(e.position,e.zoom))),t(r).zoomControl.setPosition("bottomright"),(f=e.panes)==null||f.forEach(({name:g,zIndex:s})=>{t(r).createPane(g),t(r).getPane(g).style.zIndex=s,t(r).getPane(g).style.pointerEvents="none"}),O.map=t(r),()=>t(r).remove()}),Re("map",{getMap:()=>t(r)});var c=Qt(),h=u(c);Je(h,()=>e.children),v(c),m(o,c),j()}var Yt=S("<p>No annotations found</p>"),$t=(o,e,r)=>e(t(r).id),ea=S('<tr class="h-8 hover:bg-slate-100"><td> </td><td> </td><td class="w-8"><button class="px-2 hover:text-red-600"><!></button></td></tr>'),ta=S('<div class="flex-grow overflow-auto"><table class="table w-full"><thead><tr><th class="sticky top-0 text-left bg-bg2">Label</th><th class="sticky top-0 text-left bg-bg2">Type</th><th class="sticky top-0 bg-bg2"></th></tr></thead><tbody></tbody></table></div>'),aa=S('<section class="flex flex-col flex-1 h-full overflow-hidden"><!></section>');function ra(o,e){F(e,!1);const r=h=>{confirm("Are you sure you want to delete this annotation? This action is irreversible.")&&(P.delete(h),J.removeLayer(h),U.removeLayer(h))};Ue();var i=aa(),c=u(i);E(c,()=>P.data.length==0,h=>{var w=Yt();m(h,w)},h=>{var w=ta(),f=u(w),g=H(u(f));ce(g,5,()=>P.data,ve,(s,l)=>{var _=ea(),a=u(_),x=u(a);v(a);var p=H(a),I=u(p);v(p);var C=H(p),d=u(C);d.__click=[$t,r,l];var y=u(d);We(y,{size:"15"}),v(d),v(C),v(_),V(()=>{k(x,t(l).value),k(I,t(l).type)}),m(s,_)}),v(g),v(f),v(w),m(h,w)}),v(i),m(o,i),j()}ue(["click"]);var oa=D("<desc> </desc>"),la=D("<title> </title>"),ia=D('<svg><!><!><path d="M6.1,10L4,18V8H21A2,2 0 0,0 19,6H12L10,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H19C19.9,20 20.7,19.4 20.9,18.5L23.2,10H6.1M19,18H6L7.6,12H20.6L19,18Z"></path></svg>');function na(o,e){let r=n(e,"size",8,"1em"),i=n(e,"width",24,r),c=n(e,"height",24,r),h=n(e,"color",8,"currentColor"),w=n(e,"viewBox",8,"0 0 24 24"),f=n(e,"ariaLabel",24,()=>{}),g=n(e,"ariaHidden",24,()=>{}),s=n(e,"title",24,()=>{}),l=n(e,"desc",24,()=>{}),_=n(e,"class",24,()=>{});var a=ia(),x=u(a);E(x,l,C=>{var d=oa(),y=u(d);v(d),V(()=>k(y,l())),m(C,d)});var p=H(x);E(p,s,C=>{var d=la(),y=u(d);v(d),V(()=>k(y,s())),m(C,d)});var I=H(p);v(a),V(()=>{b(a,"viewBox",w()),b(a,"width",i()),b(a,"height",c()),Y(a,_()),b(a,"aria-label",f()),b(a,"aria-hidden",g()),b(I,"fill",h())}),m(o,a)}var sa=D("<desc> </desc>"),da=D("<title> </title>"),ca=D('<svg><!><!><path d="M19,19H5V5H19M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M13.96,12.29L11.21,15.83L9.25,13.47L6.5,17H17.5L13.96,12.29Z"></path></svg>');function va(o,e){let r=n(e,"size",8,"1em"),i=n(e,"width",24,r),c=n(e,"height",24,r),h=n(e,"color",8,"currentColor"),w=n(e,"viewBox",8,"0 0 24 24"),f=n(e,"ariaLabel",24,()=>{}),g=n(e,"ariaHidden",24,()=>{}),s=n(e,"title",24,()=>{}),l=n(e,"desc",24,()=>{}),_=n(e,"class",24,()=>{});var a=ca(),x=u(a);E(x,l,C=>{var d=sa(),y=u(d);v(d),V(()=>k(y,l())),m(C,d)});var p=H(x);E(p,s,C=>{var d=da(),y=u(d);v(d),V(()=>k(y,s())),m(C,d)});var I=H(p);v(a),V(()=>{b(a,"viewBox",w()),b(a,"width",i()),b(a,"height",c()),Y(a,_()),b(a,"aria-label",f()),b(a,"aria-hidden",g()),b(I,"fill",h())}),m(o,a)}var ua=(o,e,r)=>e(t(r)),fa=S('<button class="text-nowrap hover:underline"> </button>'),_a=(o,e,r)=>e(t(r)),ha=S('<tr class="hover:bg-slate-100"><td><button class="flex hover:underline items-center gap-1 w-full"><!> </button></td></tr>'),ga=(o,e,r,i)=>e(t(r)[t(i)]),ma=S('<tr><td class="pr-1"><button class="w-full"><p class="flex items-center gap-1 w-full"><!> </p></button></td></tr>'),ba=S('<tr><th class="text-left"> </th><td class="pl-1"> </td></tr>'),wa=S('<p> </p> <div class="overflow-auto flex-grow flex flex-col gap-2"><input type="text" placeholder="Search in folder ..." class="p-1 rounded-md input-sm w-full"> <div class="text-sm flex"><p>Path: /</p> <!></div> <div class="overflow-auto flex-grow"><table class="w-full"><tbody><!></tbody></table></div></div>',1),La=S("<p>No files found.</p>"),xa=S("<p>Loading files ...</p>"),ya=S('<div class="flex flex-col gap-2 h-full overflow-hidden"><!></div>');function Ha(o,e){F(e,!0);const r=pe(),i=()=>Be(Ve,"$page",r);let c=T(z({})),h=T(z([])),w=T(!1),f=T(z([])),g=T(!1),s=z({}),l=T(null);Z(async()=>{A.retrieve(i().url.searchParams.get("id"))}),Z(async()=>{B(w,!0),B(c,z({})),B(h,z([]));let M=_();B(c,z(M)),B(w,!1)}),we(()=>{A.reset()});const _=()=>{const M={};return A.data.forEach(R=>{const $=R.path.split(R.path.includes("\\")?"\\":"/");let Q=M;$.forEach((X,fe)=>{fe==$.length-1?Q[X]=R:(Q[X]||(Q[X]={}),Q=Q[X])})}),M},a=M=>{B(h,z([...t(h),t(c)])),B(c,z(t(c)[M])),C(M)},x=()=>{t(g)?(B(f,z(t(f).slice(0,t(f).length-1))),B(g,!1)):(B(c,z(t(h).pop())),B(f,z(t(f).slice(0,t(f).length-1))))},p=M=>{const R=t(f).indexOf(M)+1;t(f).length>t(h).length&&M.split(".").length<2&&(B(g,!1),B(f,z(t(f).slice(0,t(f).length-1))));for(let $=0;t(h).length-R>0;($+=1)-1)x()},I=M=>{A.current=M},C=M=>{t(h).length>0?B(f,z([...t(f),M])):B(f,z([]))};let d=Ze(()=>()=>t(l)?Object.keys(t(c)).filter(M=>M.toLowerCase().includes(t(l).toLowerCase())):Object.keys(t(c)));var y=ya(),q=u(y);E(q,()=>!t(w),M=>{var R=de(),$=W(R);E($,()=>A.data,Q=>{var X=wa(),fe=W(X),Te=u(fe);v(fe);var Ee=H(fe,2),He=u(Ee);Se(He);var Ce=H(He,2),Oe=H(u(Ce),2);ce(Oe,17,()=>t(f),ve,(re,ee)=>{var te=fa();te.__click=[ua,p,ee];var _e=u(te);v(te),V(()=>k(_e,`${t(ee)??""}/`)),m(re,te)}),v(Ce);var Ie=H(Ce,2),ke=u(Ie),De=u(ke),Pe=u(De);E(Pe,()=>t(g)==!1,re=>{var ee=de(),te=W(ee);ce(te,17,()=>t(d)(),ve,(_e,K)=>{var se=de(),he=W(se);E(he,()=>typeof t(c)[t(K)]=="object"&&!t(c)[t(K)].id,ge=>{var G=ha(),oe=u(G),le=u(oe);le.__click=[_a,a,K];var me=u(le);na(me,{size:"15"});var Le=H(me,1,!0);v(le),v(oe),v(G),V(()=>k(Le,t(K))),m(ge,G)},ge=>{var G=ma(),oe=u(G),le=u(oe);le.__click=[ga,I,c,K];var me=u(le),Le=u(me);va(Le,{size:"15"});var Ne=H(Le,1,!0);v(me),v(le),v(oe),v(G),V(()=>{var Ae,Me;ae(G,`hover:bg-slate-100 ${(((Ae=A.current)==null?void 0:Ae.id)==((Me=t(c)[t(K)])==null?void 0:Me.id)?"bg-slate-100":"")??""}`),k(Ne,t(K))}),m(ge,G)}),m(_e,se)}),m(re,ee)},re=>{var ee=de(),te=W(ee);ce(te,17,()=>Object.keys(s),ve,(_e,K)=>{var se=ba(),he=u(se),ge=u(he);v(he);var G=H(he),oe=u(G);v(G),v(se),V(()=>{k(ge,`${t(K)??""}:`),k(oe,s[t(K)])}),m(_e,se)}),m(re,ee)}),v(De),v(ke),v(Ie),v(Ee),V(()=>k(Te,`Images (${A.data.length??""}) :`)),qe(He,()=>t(l),re=>B(l,re)),m(Q,X)},Q=>{var X=La();m(Q,X)}),m(M,R)},M=>{var R=xa();m(M,R)}),v(y),m(o,y),j()}ue(["click"]);var Ca=(o,e)=>B(e,"labels"),pa=(o,e)=>B(e,"annotations"),Ba=S('<div class="flex flex-col p-3 border-l bg-bg2 border-border w-[300px] h-full justify-between"><div class="h-[250px]"><!></div> <div class="flex flex-col flex-1 h-full"><div class="w-full h-[2px] bg-slate-500 rounded-full my-2"></div> <span class="flex gap-4"><button>Labels</button> <button>Annotations</button></span> <!> <!></div></div>');function Va(o,e){F(e,!0);let r=T("labels");Z(async()=>{if(A.current){const a=await P.retrieve(A.current.id);J.initItems(O.map),U.initItems(O.map),a==null||a.forEach(x=>{x.type==="detection"&&J.addLayer(x),x.type==="segmentation"&&U.addLayer(x)})}}),we(()=>{N.reset(),J.remove(O.map),U.remove(O.map),P.reset()});var i=Ba(),c=u(i),h=u(c);Ha(h,{}),v(c);var w=H(c,2),f=H(u(w),2),g=u(f);g.__click=[Ca,r];var s=H(g,2);s.__click=[pa,r],v(f);var l=H(f,2);E(l,()=>t(r)==="labels",a=>{je(a,{})});var _=H(l,2);E(_,()=>t(r)==="annotations",a=>{ra(a,{})}),v(w),v(i),V(()=>{ae(g,`pb-1 ${(t(r)==="labels"?"border-b-2 border-primary":"")??""}`),ae(s,`pb-1 ${(t(r)==="annotations"?"border-b-2 border-primary":"")??""}`)}),m(o,i),j()}ue(["click"]);function ze(o,e){F(e,!0);const{getMap:r}=Fe("map");let i=null;Z(()=>{const c=r();return c&&(i=L.tileLayer(e.url,e.options).addTo(c)),()=>i==null?void 0:i.remove()}),j()}var Ea=S('<label class="svelte-u9pskg"><input type="radio" name="layers"> </label>'),Ia=S('<form class="svelte-u9pskg"></form>');function ka(o,e){const r=[];let i=n(e,"layers",19,()=>["streets","satellite"]),c=n(e,"layer",15);var h=Ia();ce(h,21,i,ve,(w,f)=>{var g=Ea(),s=u(g);Se(s);var l,_=H(s);v(g),V(()=>{l!==(l=t(f))&&(s.value=(s.__value=t(f))==null?"":t(f)),k(_,` ${t(f)??""}`)}),Ke(r,[],s,()=>(t(f),c()),c),m(w,g)}),v(h),m(o,h)}function Da(o,e){F(e,!0);let r=n(e,"stretch",19,()=>[0,3e3]),i=n(e,"bands",19,()=>[4,3,2]),c=n(e,"palette",3,"viridis"),h=T(null),w=T(!1);Z(()=>{const f=O.map;f&&(t(w)||(ie.initItems(f),A.data.forEach(g=>{ie.addBbox(g,f)}),ie.zoom(f)),ne.showImageBBs||ie.hide(f),A.data.length>0&&B(w,!0))}),Z(()=>{const f=O.map;if(f&&A.current){A.zoom(JSON.parse(A.current.bbox),f);let g=`${Qe}/images/${A.current.path}/{z}/{x}/{y}.png?stretch=${r()}&bands=${i()}&palette=${c()}`;console.log("eotdlDatasetId",ye.current),ye.current.eotdlDatasetId&&(g+=`&eotdlDatasetId=${ye.current.eotdlDatasetId}`),t(h)?t(h).setUrl(g):B(h,z(L.tileLayer(g,e.options).addTo(f)))}}),we(()=>{ie.remove(O.map),B(w,!1)}),j()}var Aa=S("<!> <!>",1),Ma=S('<div class="flex flex-col flex-1 h-full"><!> <div class="flex flex-row flex-1 w-full h-full"><div class="flex-1"><!></div> <div class="w-[300px]"><!></div></div></div> <!>',1);function tr(o,e){F(e,!0);const r=pe(),i=()=>Be(Ve,"$page",r);let c=T("streets");Z(()=>{ye.retrieveOne(i().url.searchParams.get("id"))});var h=Ma(),w=W(h),f=u(w);Kt(f);var g=H(f,2),s=u(g),l=u(s);Xt(l,{position:[42.0407,3.1],zoom:4,children:(p,I)=>{var C=Aa(),d=W(C);E(d,()=>t(c)=="streets",q=>{ze(q,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{maxZoom:20,zIndex:1}})},q=>{var M=de(),R=W(M);E(R,()=>t(c)=="satellite",$=>{ze($,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{maxZoom:20,zIndex:1}})},null,!0),m(q,M)});var y=H(d,2);ka(y,{layers:["streets","satellite"],get layer(){return t(c)},set layer(q){B(c,z(q))}}),m(p,C)},$$slots:{default:!0}}),v(s);var _=H(s,2),a=u(_);Va(a,{}),v(_),v(g),v(w);var x=H(w,2);E(x,()=>A.data,p=>{Da(p,{})}),m(o,h),j()}export{tr as component};
