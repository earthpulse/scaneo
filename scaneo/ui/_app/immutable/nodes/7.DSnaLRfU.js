const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../assets/leaflet.GL2v8lVq.css","../assets/leaflet.jCI8mrZJ.css"])))=>i.map(i=>d[i]);
import{a as w,n as M,t as T,c as ve}from"../chunks/disclose-version.hHXjza9X.js";import{t as V,c as h,s as C,r as f,g as t,b,e as D,p as F,u as Z,a as j,f as W,aE as Fe,d as je,aF as Ge}from"../chunks/runtime.B40kIuYm.js";import{i as I}from"../chunks/if.BU02RLSO.js";import{p as E}from"../chunks/proxy.B3-__M_J.js";import{s as Ee,a as Ve,p as Ie}from"../chunks/stores.jAWgkzgh.js";import{d as _e}from"../chunks/events.DTvxUH_b.js";import{a as Y,s as ae}from"../chunks/class.ysGxxhcu.js";import{s as k}from"../chunks/render.CM3wPBfR.js";import{a as y,r as Oe}from"../chunks/attributes.faLUl4vZ.js";import{p as s}from"../chunks/props.BJTpJmXG.js";import{_ as Le}from"../chunks/preload-helper.C1FmrZbK.js";import{b as re,f as de}from"../chunks/fetcher.CABHu9Eq.js";import{l as N,L as We}from"../chunks/Labels.VEoLoJhF.js";import{o as ye}from"../chunks/index-client.JNdFE_pc.js";import{e as ue,i as fe}from"../chunks/each.DvJ5DvNT.js";import{b as Je,D as Ue}from"../chunks/DeleteOutline.CIoqQZFN.js";import{m as He}from"../chunks/models.svelte.5lccqy5G.js";import{s as qe}from"../chunks/snippet.BlUAN25S.js";import{i as Ke}from"../chunks/lifecycle.BHVFZquU.js";import{b as Qe,a as Xe}from"../chunks/input.CHcNizJA.js";import{c as Be}from"../chunks/campaigns.svelte.DVU4IFDS.js";var Ye=M("<desc> </desc>"),$e=M("<title> </title>"),et=M('<svg><!><!><path d="M12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5M12,2A7,7 0 0,1 19,9C19,14.25 12,22 12,22C12,22 5,14.25 5,9A7,7 0 0,1 12,2M12,4A5,5 0 0,0 7,9C7,10 7,12 12,18.71C17,12 17,10 17,9A5,5 0 0,0 12,4Z"></path></svg>');function tt(r,e){let a=s(e,"size",8,"1em"),l=s(e,"width",24,a),i=s(e,"height",24,a),v=s(e,"color",8,"currentColor"),g=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),_=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=et(),x=h(o);I(x,n,p=>{var u=Ye(),H=h(u);f(u),V(()=>k(H,n())),w(p,u)});var B=C(x);I(B,c,p=>{var u=$e(),H=h(u);f(u),V(()=>k(H,c())),w(p,u)});var A=C(B);f(o),V(()=>{y(o,"viewBox",g()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",_()),y(A,"fill",v())}),w(r,o)}var at=M("<desc> </desc>"),rt=M("<title> </title>"),ot=M('<svg><!><!><path d="M5,3C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19H5V5H12V3H5M17.78,4C17.61,4 17.43,4.07 17.3,4.2L16.08,5.41L18.58,7.91L19.8,6.7C20.06,6.44 20.06,6 19.8,5.75L18.25,4.2C18.12,4.07 17.95,4 17.78,4M15.37,6.12L8,13.5V16H10.5L17.87,8.62L15.37,6.12Z"></path></svg>');function it(r,e){let a=s(e,"size",8,"1em"),l=s(e,"width",24,a),i=s(e,"height",24,a),v=s(e,"color",8,"currentColor"),g=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),_=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=ot(),x=h(o);I(x,n,p=>{var u=at(),H=h(u);f(u),V(()=>k(H,n())),w(p,u)});var B=C(x);I(B,c,p=>{var u=rt(),H=h(u);f(u),V(()=>k(H,c())),w(p,u)});var A=C(B);f(o),V(()=>{y(o,"viewBox",g()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",_()),y(A,"fill",v())}),w(r,o)}var lt=M("<desc> </desc>"),nt=M("<title> </title>"),st=M('<svg><!><!><path d="M2,2V8H4.28L5.57,16H4V22H10V20.06L15,20.05V22H21V16H19.17L20,9H22V3H16V6.53L14.8,8H9.59L8,5.82V2M4,4H6V6H4M18,5H20V7H18M6.31,8H7.11L9,10.59V14H15V10.91L16.57,9H18L17.16,16H15V18.06H10V16H7.6M11,10H13V12H11M6,18H8V20H6M17,18H19V20H17"></path></svg>');function dt(r,e){let a=s(e,"size",8,"1em"),l=s(e,"width",24,a),i=s(e,"height",24,a),v=s(e,"color",8,"currentColor"),g=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),_=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=st(),x=h(o);I(x,n,p=>{var u=lt(),H=h(u);f(u),V(()=>k(H,n())),w(p,u)});var B=C(x);I(B,c,p=>{var u=nt(),H=h(u);f(u),V(()=>k(H,c())),w(p,u)});var A=C(B);f(o),V(()=>{y(o,"viewBox",g()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",_()),y(A,"fill",v())}),w(r,o)}function ct(){let r=D(null);return{get map(){return t(r)},set map(e){b(r,E(e))}}}const O=ct(),vt=async r=>{const e=`${re.api_url}/annotations/${r}`;return de(e)};async function ut(r,e){const a=`${re.api_url}/annotations/classification`;return de(a,"POST",{label:r,imageId:e})}async function ft(r,e,a){const l=`${re.api_url}/annotations/detection`;return de(l,"POST",{bb:r,label:e,imageId:a})}async function _t(r,e,a){const l=`${re.api_url}/annotations/segmentation`;return de(l,"POST",{layer_data:r,label:e,imageId:a})}const ht=async r=>{const e=`${re.api_url}/annotations/${r}`;return de(e,"DELETE")};async function gt(r,e){const a=`${re.api_url}/annotations/detection/${r}`;return de(a,"PUT",{bb:e})}function mt(){let r=D(E([])),e=D(!0),a=D(null),l=D(null);return{get data(){return t(r)},get loading(){return t(e)},get error(){return t(a)},get current(){return t(l)},set current(i){b(l,E(i))},retrieve:async i=>{b(e,!0);const{data:v,error:g}=await vt(i);return g&&b(a,E(g.message)),b(r,E(v)),b(e,!1),v},createClassification:async(i,v)=>{const{data:g,error:d}=await ut(i,v);if(d)throw new Error(d.message);t(r).find(_=>_.id===g.id)?b(r,E(t(r).map(_=>_.id===g.id?g:_))):b(r,E([g,...t(r)]))},createDetection:async(i,v,g)=>{const{data:d,error:_}=await ft(i,v,g);if(_)throw new Error(_.message);return b(r,E([d,...t(r)])),d},updateDetection:async(i,v)=>{const{data:g,error:d}=await gt(i,v);if(d)throw new Error(d.message);b(r,E(t(r).map(_=>_.id===i?{..._,bb:v}:_)))},createSegmentation:async(i,v,g)=>{const{data:d,error:_}=await _t(i,v,g);if(_)throw new Error(_.message);return b(r,E([d,...t(r)])),d},delete:async i=>{const{error:v}=await ht(i);if(v)throw new Error(v.message);b(r,E(t(r).filter(g=>g.id!==i)))},reset:()=>{b(r,E([])),b(e,!0),b(a,null),b(l,null)}}}const P=mt(),bt=async r=>{const e=`${re.api_url}/images/${r}`;return de(e)};function wt(){let r=D(E([])),e=D(!0),a=D(null),l=D(null);return{get data(){return t(r)},get loading(){return t(e)},get error(){return t(a)},get current(){return t(l)},set current(i){b(l,E(i))},retrieve:async i=>{b(e,!0);const{data:v,error:g}=await bt(i);g&&b(a,E(g.message)),b(r,E(v)),console.log(v),b(e,!1)},zoom:(i,v)=>{const g=L.latLng(i[1],i[0]),d=L.latLng(i[3],i[2]),_=L.latLngBounds(g,d);v.fitBounds(_)},reset:()=>{b(r,E([])),b(e,!0),b(a,null),b(l,null)}}}const z=wt();function Lt(){let r=D(null),e=D(null),a,l,i;const v=async n=>{const{layer:m}=n,o=m.getBounds(),x=await P.createDetection([[o._southWest.lat,o._northEast.lng],[o._northEast.lat,o._southWest.lng]],N.current,z.current.id);m.options.color=N.data.filter(B=>x.value==B.name)[0].color,m.annotationId=x.id,t(r).addLayer(m)},g=n=>{n.layers.eachLayer(m=>{const o=m.getBounds();P.updateDetection(m.annotationId,[[o._southWest.lat,o._northEast.lng],[o._northEast.lat,o._southWest.lng]])})},d=n=>{n.layers.eachLayer(m=>{P.delete(m.annotationId)})},_=n=>{t(r)?t(r).clearLayers():b(r,E(new L.FeatureGroup)),n.addLayer(t(r))};return{initItems:_,initControls:n=>{t(r)||_(n),a&&n.off(L.Draw.Event.CREATED,a),l&&n.off(L.Draw.Event.EDITED,l),i&&n.off(L.Draw.Event.DELETED,i),t(e)&&n.removeControl(t(e)),b(e,E(new L.Control.Draw({position:"topright",edit:{featureGroup:t(r)},draw:{polyline:!1,circlemarker:!1,circle:!1,marker:!1,rectangle:{repeatMode:!0,showArea:!1,showLength:!0,shapeOptions:{weight:1}},polygon:!1}}))),n.addControl(t(e)),a=async m=>await v(m),l=g,i=d,n.on(L.Draw.Event.CREATED,a),n.on(L.Draw.Event.EDITED,l),n.on(L.Draw.Event.DELETED,i)},remove:n=>{t(r)&&(n==null||n.removeLayer(t(r))),t(e)&&(n==null||n.removeControl(t(e))),a&&n.off(L.Draw.Event.CREATED,a),l&&n.off(L.Draw.Event.EDITED,l),i&&n.off(L.Draw.Event.DELETED,i),b(r,null),b(e,null)},addLayer:n=>{const m=n.bb,o=L.rectangle([[m[0][0],m[0][1]],[m[1][0],m[1][1]]],{editing:!0});o.options.color=N.data.filter(x=>n.value==x.name)[0].color,o.annotationId=n.id,t(r).addLayer(o)},removeLayer:n=>{t(r).eachLayer(m=>{m.annotationId===n&&t(r).removeLayer(m)})}}}const J=Lt();function yt(){let r=D(null),e=D(null);const a=()=>P.data.find(c=>c.value==N.current&&c.type=="segmentation"),l=()=>{if(a()){const c=a();t(e).setData(c.layer_data),t(e).options.layerOptions.color=N.data.filter(n=>c.value==n.name)[0].color,t(r).eachLayer(n=>{n.annotationId===c.id&&t(r).removeLayer(n)})}},i=async()=>{var n;const c=(n=t(e))==null?void 0:n.getData();if(c)try{if(a()){const x=a();v(x.id)}const m=await P.createSegmentation(c,N.current,z.current.id),o=L.geoJSON(c,{style:{color:N.data.filter(x=>m.value==x.name)[0].color}});o.annotationId=m.id,t(r).addLayer(o),t(e).eraseAll()}catch(m){console.error("Error saving annotation:",m)}},v=c=>{t(r).eachLayer(n=>{n.annotationId===c&&(t(r).removeLayer(n),P.delete(c))}),P.delete(c)};return{initItems:c=>{t(r)?t(r).clearLayers():b(r,E(new L.FeatureGroup)),c.addLayer(t(r))},initControls:c=>{t(e)&&(t(e).stop(),c.removeControl(t(e))),b(e,E(L.control.paintPolygon({layerOptions:{color:N.data.filter(n=>N.current==n.name)[0].color}}))),c.addControl(t(e)),c.on("mousedown",l),c.on("mouseup",i)},addLayer:c=>{const n=L.geoJSON(c.layer_data,{style:{color:N.data.filter(m=>c.value==m.name)[0].color}});n.annotationId=c.id,t(r).addLayer(n)},remove:c=>{t(e)&&(t(e).stop(),t(e).eraseAll(),c.removeControl(t(e)),c.off("mousedown",l),c.off("mouseup",i)),t(r)&&(c==null||c.removeLayer(t(r))),b(r,null),b(e,null)},removeLayer:v}}const U=yt();function xt(r,e){F(e,!0),Z(async()=>{await Le(()=>import("../chunks/leaflet.draw.cJkf-kdY.js"),[],import.meta.url),await Le(()=>Promise.resolve({}),__vite__mapDeps([0]),import.meta.url);const a=await P.retrieve(z.current.id),l=O.map;U.remove(l),J.initControls(l),J.initItems(O.map),a==null||a.forEach(i=>{i.type==="detection"&&J.addLayer(i)})}),ye(()=>{J.remove(O.map)}),j()}function Ht(r,e){F(e,!0),Z(async()=>{await Le(()=>import("../chunks/Leaflet.PaintPolygon.BL41ABOh.js"),[],import.meta.url);const a=O.map;J.remove(a),U.initControls(a),U.initItems(a);const l=await P.retrieve(z.current.id);l==null||l.forEach(i=>{i.type==="segmentation"&&U.addLayer(i)})}),ye(()=>{U.remove(O.map)}),j()}var Ct=M("<desc> </desc>"),pt=M("<title> </title>"),Bt=M('<svg><!><!><path d="M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C15.76,17.5 19.17,15.36 20.82,12C19.17,8.64 15.76,6.5 12,6.5C8.24,6.5 4.83,8.64 3.18,12Z"></path></svg>');function Et(r,e){let a=s(e,"size",8,"1em"),l=s(e,"width",24,a),i=s(e,"height",24,a),v=s(e,"color",8,"currentColor"),g=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),_=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=Bt(),x=h(o);I(x,n,p=>{var u=Ct(),H=h(u);f(u),V(()=>k(H,n())),w(p,u)});var B=C(x);I(B,c,p=>{var u=pt(),H=h(u);f(u),V(()=>k(H,c())),w(p,u)});var A=C(B);f(o),V(()=>{y(o,"viewBox",g()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",_()),y(A,"fill",v())}),w(r,o)}const Vt=async(r,e,a)=>{if(e()){b(a,"classification");try{await P.createClassification(N.current,z.current.id)}catch(l){console.error(l)}}},It=(r,e,a)=>{e()&&b(a,"detection")},Dt=(r,e,a)=>{e()&&b(a,"segmentation")},At=async(r,e)=>{b(e,null);const a=await P.retrieve(z.current.id);J.initItems(O.map),U.initItems(O.map),a==null||a.forEach(l=>{l.type==="detection"&&J.addLayer(l),l.type==="segmentation"&&U.addLayer(l)})};var kt=T('<button data-tip="Classification"><!></button> <button data-tip="Detection"><!></button> <button data-tip="Segmentation"><!></button> <button data-tip="See all annotations"><!></button> <!> <!>',1);function Mt(r,e){F(e,!0);let a=D(null);const l=()=>z.current?N.current?!0:alert("Select label"):alert("Select image");var i=kt(),v=W(i);v.__click=[Vt,l,a];var g=h(v);tt(g,{size:"15"}),f(v);var d=C(v,2);d.__click=[It,l,a];var _=h(d);it(_,{size:"15"}),f(d);var c=C(d,2);c.__click=[Dt,l,a];var n=h(c);dt(n,{size:"15"}),f(c);var m=C(c,2);m.__click=[At,a];var o=h(m);Et(o,{size:"15"}),f(m);var x=C(m,2);I(x,()=>t(a)==="detection",A=>{xt(A,{})});var B=C(x,2);I(B,()=>t(a)==="segmentation",A=>{Ht(A,{})}),V(()=>{ae(v,`btn ${(t(a)==="classification"?"btn-primary":"btn-outline")??""} btn-sm tooltip tooltip-right flex items-center p-2`),ae(d,`btn ${(t(a)==="detection"?"btn-primary":"btn-outline")??""} btn-sm tooltip flex items-center p-2`),ae(c,`btn ${(t(a)==="segmentation"?"btn-primary":"btn-outline")??""} btn-sm tooltip flex items-center p-2`),ae(m,`btn ${(t(a)===null?"btn-primary":"btn-outline")??""} btn-sm tooltip flex items-center p-2`)}),w(r,i),j()}_e(["click"]);var zt=M("<desc> </desc>"),St=M("<title> </title>"),Tt=M('<svg><!><!><path d="M17.5 15.5C17.5 16.61 16.61 17.5 15.5 17.5S13.5 16.61 13.5 15.5 14.4 13.5 15.5 13.5 17.5 14.4 17.5 15.5M8.5 13.5C7.4 13.5 6.5 14.4 6.5 15.5S7.4 17.5 8.5 17.5 10.5 16.61 10.5 15.5 9.61 13.5 8.5 13.5M23 15V18C23 18.55 22.55 19 22 19H21V20C21 21.11 20.11 22 19 22H5C3.9 22 3 21.11 3 20V19H2C1.45 19 1 18.55 1 18V15C1 14.45 1.45 14 2 14H3C3 10.13 6.13 7 10 7H11V5.73C10.4 5.39 10 4.74 10 4C10 2.9 10.9 2 12 2S14 2.9 14 4C14 4.74 13.6 5.39 13 5.73V7H14C17.87 7 21 10.13 21 14H22C22.55 14 23 14.45 23 15M21 16H19V14C19 11.24 16.76 9 14 9H10C7.24 9 5 11.24 5 14V16H3V17H5V20H19V17H21V16Z"></path></svg>');function Ot(r,e){let a=s(e,"size",8,"1em"),l=s(e,"width",24,a),i=s(e,"height",24,a),v=s(e,"color",8,"currentColor"),g=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),_=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=Tt(),x=h(o);I(x,n,p=>{var u=zt(),H=h(u);f(u),V(()=>k(H,n())),w(p,u)});var B=C(x);I(B,c,p=>{var u=St(),H=h(u);f(u),V(()=>k(H,c())),w(p,u)});var A=C(B);f(o),V(()=>{y(o,"viewBox",g()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",_()),y(A,"fill",v())}),w(r,o)}var Pt=T('<div class="w-[2px] h-[30px] bg-slate-500 self-center rounded-full"></div>');function Nt(r){var e=Pt();w(r,e)}const Rt=async(r,e,a)=>{if(!z.current)return alert("Select image");if(!t(e))return alert("Select model");b(a,!0);try{const l=await He.inference(t(e),z.current.id);O.map.addLayer(L.geoJSON(l))}catch(l){console.error(l),alert(l)}finally{b(a,!1)}};var Zt=T("<option> </option>"),Ft=T('<!> <select class="select select-sm"><option disabled>Select a model</option><!></select> <button class="btn btn-sm tooltip flex items-center p-2 btn-outline" data-tip="Run model inference"><!></button>',1);function jt(r,e){F(e,!0);const a=Ee(),l=()=>Ve(Ie,"$page",a);let i=D(null),v=D(!1);Z(()=>{He.retrieve(l().params.campaign)});var g=ve(),d=W(g);I(d,()=>{var _;return((_=He.data)==null?void 0:_.length)>0},_=>{var c=Ft(),n=W(c);Nt(n);var m=C(n,2),o=h(m);o.value=(o.__value=null)==null?"":null;var x=C(o);ue(x,17,()=>He.data,fe,(p,u)=>{var H=Zt(),q={},S=h(H);f(H),V(()=>{q!==(q=t(u).id)&&(H.value=(H.__value=t(u).id)==null?"":t(u).id),k(S,t(u).name)}),w(p,H)}),f(m);var B=C(m,2);B.__click=[Rt,i,v];var A=h(B);Ot(A,{size:"15"}),f(B),V(()=>B.disabled=t(v)),Je(m,()=>t(i),p=>b(i,p)),w(_,c)}),w(r,g),j()}_e(["click"]);function Gt(){let r=D(null);return{set showImageBBs(e){b(r,E(e)),localStorage.setItem("showImageBBs",e)},get showImageBBs(){return t(r)},init:()=>{b(r,localStorage.getItem("showImageBBs")==="true")}}}const se=Gt();function Wt(){let r=D(null);return{initItems:e=>{t(r)?t(r).clearLayers():b(r,E(new L.FeatureGroup)),e.addLayer(t(r))},addBbox:(e,a)=>{let l=e.bbox;l=L.rectangle([[l[1],l[0]],[l[3],l[2]]],{interactive:!0,weight:10}),l.annotationId=e.path,l.on("click",()=>{a.fitBounds(l.getBounds()),z.current=e}),t(r).addLayer(l)},zoom:e=>{const a=t(r).getBounds();a.isValid()&&e.fitBounds(a)},toggle:e=>{se.showImageBBs?(e.removeLayer(t(r)),se.showImageBBs=!1):(e.addLayer(t(r)),se.showImageBBs=!0)},hide:e=>{e==null||e.removeLayer(t(r))},remove:e=>{e==null||e.removeLayer(t(r))}}}const ne=Wt();var Jt=M("<desc> </desc>"),Ut=M("<title> </title>"),qt=M('<svg><!><!><path d="M20,16V10H22V16A2,2 0 0,1 20,18H8C6.89,18 6,17.1 6,16V4C6,2.89 6.89,2 8,2H16V4H8V16H20M10.91,7.08L14,10.17L20.59,3.58L22,5L14,13L9.5,8.5L10.91,7.08M16,20V22H4A2,2 0 0,1 2,20V7H4V20H16Z"></path></svg>');function Kt(r,e){let a=s(e,"size",8,"1em"),l=s(e,"width",24,a),i=s(e,"height",24,a),v=s(e,"color",8,"currentColor"),g=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),_=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=qt(),x=h(o);I(x,n,p=>{var u=Jt(),H=h(u);f(u),V(()=>k(H,n())),w(p,u)});var B=C(x);I(B,c,p=>{var u=Ut(),H=h(u);f(u),V(()=>k(H,c())),w(p,u)});var A=C(B);f(o),V(()=>{y(o,"viewBox",g()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",_()),y(A,"fill",v())}),w(r,o)}var Qt=M("<desc> </desc>"),Xt=M("<title> </title>"),Yt=M('<svg><!><!><path d="M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22H20A2,2 0 0,0 22,20V12A10,10 0 0,0 12,2M13,7H11V11H7V13H11V17H13V13H17V11H13V7Z"></path></svg>');function $t(r,e){let a=s(e,"size",8,"1em"),l=s(e,"width",24,a),i=s(e,"height",24,a),v=s(e,"color",8,"currentColor"),g=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),_=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=Yt(),x=h(o);I(x,n,p=>{var u=Qt(),H=h(u);f(u),V(()=>k(H,n())),w(p,u)});var B=C(x);I(B,c,p=>{var u=Xt(),H=h(u);f(u),V(()=>k(H,c())),w(p,u)});var A=C(B);f(o),V(()=>{y(o,"viewBox",g()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",_()),y(A,"fill",v())}),w(r,o)}var ea=()=>ne.toggle(O.map),ta=()=>ne.zoom(O.map),aa=T('<section class="flex flex-row gap-2"><span><button><!></button></span> <button class="btn btn-sm btn-outline tooltip tooltip-left flex items-center p-2" data-tip="Reset map"><!></button></section>');function ra(r,e){F(e,!0),Z(()=>{se.init()});var a=aa(),l=h(a),i=h(l);i.__click=[ea];var v=h(i);Kt(v,{size:"15"}),f(i),f(l);var g=C(l,2);g.__click=[ta];var d=h(g);$t(d,{size:"15"}),f(g),f(a),V(()=>{ae(i,`btn btn-sm tooltip flex items-center p-2 ${(se.showImageBBs?"btn-primary":"btn-outline")??""}`),y(i,"data-tip",`${(se.showImageBBs?"Hide":"Show")??""} bbs`)}),w(r,a),j()}_e(["click"]);var oa=T('<nav class="flex flex-row gap-2 bg-bg2 p-3 border-b border-t border-border justify-between"><span class="flex flex-row gap-2"><!> <!></span> <!></nav>');function ia(r){var e=oa(),a=h(e),l=h(a);Mt(l,{});var i=C(l,2);jt(i,{}),f(a);var v=C(a,2);ra(v,{}),f(e),w(r,e)}var la=T('<div id="map" class="svelte-g0bqmp"><!></div>');function na(r,e){F(e,!0);let a=D(null),l={attributionControl:!1,max_zoom:20};Z(async()=>{var d;const g=await Le(()=>import("../chunks/leaflet-src.DTmlu4rB.js").then(_=>_.l),[],import.meta.url);return await Le(()=>Promise.resolve({}),__vite__mapDeps([1]),import.meta.url),b(a,E(g.map("map",l).setView(e.position,e.zoom))),t(a).zoomControl.setPosition("bottomright"),(d=e.panes)==null||d.forEach(({name:_,zIndex:c})=>{t(a).createPane(_),t(a).getPane(_).style.zIndex=c,t(a).getPane(_).style.pointerEvents="none"}),O.map=t(a),()=>t(a).remove()}),Fe("map",{getMap:()=>t(a)});var i=la(),v=h(i);qe(v,()=>e.children),f(i),w(r,i),j()}var sa=T("<p>No annotations found</p>"),da=(r,e,a)=>e(t(a).id),ca=T('<tr class="h-8 hover:bg-slate-100"><td> </td><td> </td><td class="w-8"><button class="px-2 hover:text-red-600"><!></button></td></tr>'),va=T('<div class="flex-grow overflow-auto"><table class="table w-full"><thead><tr><th class="sticky top-0 text-left bg-bg2">Label</th><th class="sticky top-0 text-left bg-bg2">Type</th><th class="sticky top-0 bg-bg2"></th></tr></thead><tbody></tbody></table></div>'),ua=T('<section class="flex flex-col flex-1 h-full overflow-hidden"><!></section>');function fa(r,e){F(e,!1);const a=v=>{confirm("Are you sure you want to delete this annotation? This action is irreversible.")&&(P.delete(v),J.removeLayer(v),U.removeLayer(v))};Ke();var l=ua(),i=h(l);I(i,()=>P.data.length==0,v=>{var g=sa();w(v,g)},v=>{var g=va(),d=h(g),_=C(h(d));ue(_,5,()=>P.data,fe,(c,n)=>{var m=ca(),o=h(m),x=h(o);f(o);var B=C(o),A=h(B);f(B);var p=C(B),u=h(p);u.__click=[da,a,n];var H=h(u);Ue(H,{size:"15"}),f(u),f(p),f(m),V(()=>{k(x,t(n).value),k(A,t(n).type)}),w(c,m)}),f(_),f(d),f(g),w(v,g)}),f(l),w(r,l),j()}_e(["click"]);var _a=M("<desc> </desc>"),ha=M("<title> </title>"),ga=M('<svg><!><!><path d="M6.1,10L4,18V8H21A2,2 0 0,0 19,6H12L10,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H19C19.9,20 20.7,19.4 20.9,18.5L23.2,10H6.1M19,18H6L7.6,12H20.6L19,18Z"></path></svg>');function ma(r,e){let a=s(e,"size",8,"1em"),l=s(e,"width",24,a),i=s(e,"height",24,a),v=s(e,"color",8,"currentColor"),g=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),_=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=ga(),x=h(o);I(x,n,p=>{var u=_a(),H=h(u);f(u),V(()=>k(H,n())),w(p,u)});var B=C(x);I(B,c,p=>{var u=ha(),H=h(u);f(u),V(()=>k(H,c())),w(p,u)});var A=C(B);f(o),V(()=>{y(o,"viewBox",g()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",_()),y(A,"fill",v())}),w(r,o)}var ba=M("<desc> </desc>"),wa=M("<title> </title>"),La=M('<svg><!><!><path d="M19,19H5V5H19M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M13.96,12.29L11.21,15.83L9.25,13.47L6.5,17H17.5L13.96,12.29Z"></path></svg>');function ya(r,e){let a=s(e,"size",8,"1em"),l=s(e,"width",24,a),i=s(e,"height",24,a),v=s(e,"color",8,"currentColor"),g=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),_=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=La(),x=h(o);I(x,n,p=>{var u=ba(),H=h(u);f(u),V(()=>k(H,n())),w(p,u)});var B=C(x);I(B,c,p=>{var u=wa(),H=h(u);f(u),V(()=>k(H,c())),w(p,u)});var A=C(B);f(o),V(()=>{y(o,"viewBox",g()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",_()),y(A,"fill",v())}),w(r,o)}var xa=(r,e,a)=>e(t(a)),Ha=T('<button class="text-nowrap hover:underline"> </button>'),Ca=(r,e,a)=>e(t(a)),pa=T('<tr class="hover:bg-slate-100"><td><button class="flex hover:underline items-center gap-1 w-full"><!> </button></td></tr>'),Ba=(r,e,a,l)=>e(t(a)[t(l)]),Ea=T('<tr><td class="pr-1"><button class="w-full"><p class="flex items-center gap-1 w-full"><!> </p></button></td></tr>'),Va=T('<tr><th class="text-left"> </th><td class="pl-1"> </td></tr>'),Ia=T('<p> </p> <div class="overflow-auto flex-grow flex flex-col gap-2"><input type="text" placeholder="Search in folder ..." class="p-1 rounded-md input-sm w-full"> <div class="text-sm flex"><p>Path: /</p> <!></div> <div class="overflow-auto flex-grow"><table class="w-full"><tbody><!></tbody></table></div></div>',1),Da=T("<p>No files found.</p>"),Aa=T("<p>Loading files ...</p>"),ka=T('<div class="flex flex-col gap-2 h-full overflow-hidden"><!></div>');function Ma(r,e){F(e,!0);const a=Ee(),l=()=>Ve(Ie,"$page",a);let i=D(E({})),v=D(E([])),g=D(!1),d=D(E([])),_=D(!1),c=E({}),n=D(null);Z(async()=>{z.retrieve(l().url.searchParams.get("id"))}),Z(async()=>{b(g,!0),b(i,E({})),b(v,E([]));let S=m();b(i,E(S)),b(g,!1)}),ye(()=>{z.reset()});const m=()=>{const S={};return z.data.forEach(R=>{const $=R.path.split(R.path.includes("\\")?"\\":"/");let Q=S;$.forEach((X,he)=>{he==$.length-1?Q[X]=R:(Q[X]||(Q[X]={}),Q=Q[X])})}),S},o=S=>{b(v,E([...t(v),t(i)])),b(i,E(t(i)[S])),p(S)},x=()=>{t(_)?(b(d,E(t(d).slice(0,t(d).length-1))),b(_,!1)):(b(i,E(t(v).pop())),b(d,E(t(d).slice(0,t(d).length-1))))},B=S=>{const R=t(d).indexOf(S)+1;t(d).length>t(v).length&&S.split(".").length<2&&(b(_,!1),b(d,E(t(d).slice(0,t(d).length-1))));for(let $=0;t(v).length-R>0;($+=1)-1)x()},A=S=>{z.current=S},p=S=>{t(v).length>0?b(d,E([...t(d),S])):b(d,E([]))};let u=je(()=>()=>t(n)?Object.keys(t(i)).filter(S=>S.toLowerCase().includes(t(n).toLowerCase())):Object.keys(t(i)));var H=ka(),q=h(H);I(q,()=>!t(g),S=>{var R=ve(),$=W(R);I($,()=>z.data,Q=>{var X=Ia(),he=W(X),Pe=h(he);f(he);var De=C(he,2),Ce=h(De);Oe(Ce);var pe=C(Ce,2),Ne=C(h(pe),2);ue(Ne,17,()=>t(d),fe,(oe,ee)=>{var te=Ha();te.__click=[xa,B,ee];var ge=h(te);f(te),V(()=>k(ge,`${t(ee)??""}/`)),w(oe,te)}),f(pe);var Ae=C(pe,2),ke=h(Ae),Me=h(ke),Re=h(Me);I(Re,()=>t(_)==!1,oe=>{var ee=ve(),te=W(ee);ue(te,17,()=>t(u)(),fe,(ge,K)=>{var ce=ve(),me=W(ce);I(me,()=>typeof t(i)[t(K)]=="object"&&!t(i)[t(K)].id,be=>{var G=pa(),ie=h(G),le=h(ie);le.__click=[Ca,o,K];var we=h(le);ma(we,{size:"15"});var xe=C(we,1,!0);f(le),f(ie),f(G),V(()=>k(xe,t(K))),w(be,G)},be=>{var G=Ea(),ie=h(G),le=h(ie);le.__click=[Ba,A,i,K];var we=h(le),xe=h(we);ya(xe,{size:"15"});var Ze=C(xe,1,!0);f(we),f(le),f(ie),f(G),V(()=>{var ze,Se;ae(G,`hover:bg-slate-100 ${(((ze=z.current)==null?void 0:ze.id)==((Se=t(i)[t(K)])==null?void 0:Se.id)?"bg-slate-100":"")??""}`),k(Ze,t(K))}),w(be,G)}),w(ge,ce)}),w(oe,ee)},oe=>{var ee=ve(),te=W(ee);ue(te,17,()=>Object.keys(c),fe,(ge,K)=>{var ce=Va(),me=h(ce),be=h(me);f(me);var G=C(me),ie=h(G);f(G),f(ce),V(()=>{k(be,`${t(K)??""}:`),k(ie,c[t(K)])}),w(ge,ce)}),w(oe,ee)}),f(Me),f(ke),f(Ae),f(De),V(()=>k(Pe,`Images (${z.data.length??""}) :`)),Qe(Ce,()=>t(n),oe=>b(n,oe)),w(Q,X)},Q=>{var X=Da();w(Q,X)}),w(S,R)},S=>{var R=Aa();w(S,R)}),f(H),w(r,H),j()}_e(["click"]);var za=(r,e)=>b(e,"labels"),Sa=(r,e)=>b(e,"annotations"),Ta=T('<div class="flex flex-col p-3 border-l bg-bg2 border-border w-[300px] h-full justify-between"><div class="h-[250px]"><!></div> <div class="flex flex-col flex-1 h-full"><div class="w-full h-[2px] bg-slate-500 rounded-full my-2"></div> <span class="flex gap-4"><button>Labels</button> <button>Annotations</button></span> <!> <!></div></div>');function Oa(r,e){F(e,!0);let a=D("labels");Z(async()=>{if(z.current){const o=await P.retrieve(z.current.id);J.initItems(O.map),U.initItems(O.map),o==null||o.forEach(x=>{x.type==="detection"&&J.addLayer(x),x.type==="segmentation"&&U.addLayer(x)})}}),ye(()=>{N.reset(),J.remove(O.map),U.remove(O.map),P.reset()});var l=Ta(),i=h(l),v=h(i);Ma(v,{}),f(i);var g=C(i,2),d=C(h(g),2),_=h(d);_.__click=[za,a];var c=C(_,2);c.__click=[Sa,a],f(d);var n=C(d,2);I(n,()=>t(a)==="labels",o=>{We(o,{})});var m=C(n,2);I(m,()=>t(a)==="annotations",o=>{fa(o,{})}),f(g),f(l),V(()=>{ae(_,`pb-1 ${(t(a)==="labels"?"border-b-2 border-primary":"")??""}`),ae(c,`pb-1 ${(t(a)==="annotations"?"border-b-2 border-primary":"")??""}`)}),w(r,l),j()}_e(["click"]);function Te(r,e){F(e,!0);const{getMap:a}=Ge("map");let l=null;Z(()=>{const i=a();return i&&(l=L.tileLayer(e.url,e.options).addTo(i)),()=>l==null?void 0:l.remove()}),j()}var Pa=T('<label class="svelte-u9pskg"><input type="radio" name="layers"> </label>'),Na=T('<form class="svelte-u9pskg"></form>');function Ra(r,e){const a=[];let l=s(e,"layers",19,()=>["streets","satellite"]),i=s(e,"layer",15);var v=Na();ue(v,21,l,fe,(g,d)=>{var _=Pa(),c=h(_);Oe(c);var n,m=C(c);f(_),V(()=>{n!==(n=t(d))&&(c.value=(c.__value=t(d))==null?"":t(d)),k(m,` ${t(d)??""}`)}),Xe(a,[],c,()=>(t(d),i()),i),w(g,_)}),f(v),w(r,v)}function Za(r,e){F(e,!0);let a=s(e,"stretch",19,()=>[0,3e3]),l=s(e,"bands",19,()=>[4,3,2]),i=s(e,"palette",3,"viridis"),v=D(null),g=D(!1);Z(()=>{const d=O.map;d&&(t(g)||(ne.initItems(d),z.data.forEach(_=>{ne.addBbox(_,d)}),ne.zoom(d)),se.showImageBBs||ne.hide(d),z.data.length>0&&b(g,!0))}),Z(()=>{const d=O.map;if(d&&z.current){z.zoom(z.current.bbox,d);let _=`${re.api_url}/images/${z.current.path}/{z}/{x}/{y}.png?stretch=${a()}&bands=${l()}&palette=${i()}`;Be.current.eotdlDatasetId&&(_+=`&eotdlDatasetId=${Be.current.eotdlDatasetId}`),t(v)?t(v).setUrl(_):b(v,E(L.tileLayer(_,e.options).addTo(d)))}}),ye(()=>{ne.remove(O.map),b(g,!1)}),j()}var Fa=T("<!> <!>",1),ja=T('<div class="flex flex-col flex-1 h-full"><!> <div class="flex flex-row flex-1 w-full h-full"><div class="flex-1"><!></div> <div class="w-[300px]"><!></div></div></div> <!>',1);function vr(r,e){F(e,!0);const a=Ee(),l=()=>Ve(Ie,"$page",a);let i=D("streets");Z(()=>{Be.retrieveOne(l().url.searchParams.get("id"))});var v=ja(),g=W(v),d=h(g);ia(d);var _=C(d,2),c=h(_),n=h(c);na(n,{position:[42.0407,3.1],zoom:4,children:(B,A)=>{var p=Fa(),u=W(p);I(u,()=>t(i)=="streets",q=>{Te(q,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{maxZoom:20,zIndex:1}})},q=>{var S=ve(),R=W(S);I(R,()=>t(i)=="satellite",$=>{Te($,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{maxZoom:20,zIndex:1}})},null,!0),w(q,S)});var H=C(u,2);Ra(H,{layers:["streets","satellite"],get layer(){return t(i)},set layer(q){b(i,E(q))}}),w(B,p)},$$slots:{default:!0}}),f(c);var m=C(c,2),o=h(m);Oa(o,{}),f(m),f(_),f(g);var x=C(g,2);I(x,()=>z.data,B=>{Za(B,{})}),w(r,v),j()}export{vr as component};
