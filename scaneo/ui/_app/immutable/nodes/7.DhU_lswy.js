const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../assets/leaflet.GL2v8lVq.css","../assets/leaflet.jCI8mrZJ.css"])))=>i.map(i=>d[i]);
import{a as w,n as M,t as T,c as ve}from"../chunks/disclose-version.DymP2m3X.js";import{t as V,c as g,s as p,r as _,g as t,b,e as D,p as j,u as F,a as G,f as q,d as Pe,aE as Ge,aF as We}from"../chunks/runtime.cJOh_ioU.js";import{i as I}from"../chunks/if.Bhj5v8Zz.js";import{p as E}from"../chunks/proxy.D4aqs5o-.js";import{s as He,a as Ce,p as Be}from"../chunks/stores.BRHuMDzc.js";import{d as _e}from"../chunks/events.BOQTMbzA.js";import{a as Y,s as re}from"../chunks/class.CftKStsF.js";import{s as k}from"../chunks/render.Gnl0czpM.js";import{s as y,r as Ne}from"../chunks/attributes.CayNqfGD.js";import{p as s}from"../chunks/props.B7tyearX.js";import{_ as Le}from"../chunks/preload-helper.C1FmrZbK.js";import{b as $,f as de}from"../chunks/fetcher.C3wkiN9W.js";import{l as Z,L as Je}from"../chunks/Labels.BbpGJPmO.js";import{o as ye}from"../chunks/index-client.BS7WnwP4.js";import{e as ue,i as fe}from"../chunks/each.4KclU_0W.js";import{b as Ue,D as qe}from"../chunks/DeleteOutline.hmBvqWE8.js";import{m as pe}from"../chunks/models.svelte.BY3bXU-h.js";import{E as Ke}from"../chunks/ExportBtn.BkRmAOCz.js";import{s as Qe}from"../chunks/snippet.CdFhtc_7.js";import{i as Xe}from"../chunks/lifecycle.DM9IC38U.js";import{b as Ye,a as $e}from"../chunks/input.CvnAJZ7U.js";import{c as Ie}from"../chunks/campaigns.svelte.B65SHqyX.js";var et=M("<desc> </desc>"),tt=M("<title> </title>"),at=M('<svg><!><!><path d="M12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5M12,2A7,7 0 0,1 19,9C19,14.25 12,22 12,22C12,22 5,14.25 5,9A7,7 0 0,1 12,2M12,4A5,5 0 0,0 7,9C7,10 7,12 12,18.71C17,12 17,10 17,9A5,5 0 0,0 12,4Z"></path></svg>');function rt(a,e){let r=s(e,"size",8,"1em"),l=s(e,"width",24,r),i=s(e,"height",24,r),v=s(e,"color",8,"currentColor"),h=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),f=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=at(),x=g(o);I(x,n,B=>{var u=et(),H=g(u);_(u),V(()=>k(H,n())),w(B,u)});var C=p(x);I(C,c,B=>{var u=tt(),H=g(u);_(u),V(()=>k(H,c())),w(B,u)});var A=p(C);_(o),V(()=>{y(o,"viewBox",h()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",f()),y(A,"fill",v())}),w(a,o)}var ot=M("<desc> </desc>"),it=M("<title> </title>"),lt=M('<svg><!><!><path d="M5,3C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19H5V5H12V3H5M17.78,4C17.61,4 17.43,4.07 17.3,4.2L16.08,5.41L18.58,7.91L19.8,6.7C20.06,6.44 20.06,6 19.8,5.75L18.25,4.2C18.12,4.07 17.95,4 17.78,4M15.37,6.12L8,13.5V16H10.5L17.87,8.62L15.37,6.12Z"></path></svg>');function nt(a,e){let r=s(e,"size",8,"1em"),l=s(e,"width",24,r),i=s(e,"height",24,r),v=s(e,"color",8,"currentColor"),h=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),f=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=lt(),x=g(o);I(x,n,B=>{var u=ot(),H=g(u);_(u),V(()=>k(H,n())),w(B,u)});var C=p(x);I(C,c,B=>{var u=it(),H=g(u);_(u),V(()=>k(H,c())),w(B,u)});var A=p(C);_(o),V(()=>{y(o,"viewBox",h()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",f()),y(A,"fill",v())}),w(a,o)}var st=M("<desc> </desc>"),dt=M("<title> </title>"),ct=M('<svg><!><!><path d="M2,2V8H4.28L5.57,16H4V22H10V20.06L15,20.05V22H21V16H19.17L20,9H22V3H16V6.53L14.8,8H9.59L8,5.82V2M4,4H6V6H4M18,5H20V7H18M6.31,8H7.11L9,10.59V14H15V10.91L16.57,9H18L17.16,16H15V18.06H10V16H7.6M11,10H13V12H11M6,18H8V20H6M17,18H19V20H17"></path></svg>');function vt(a,e){let r=s(e,"size",8,"1em"),l=s(e,"width",24,r),i=s(e,"height",24,r),v=s(e,"color",8,"currentColor"),h=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),f=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=ct(),x=g(o);I(x,n,B=>{var u=st(),H=g(u);_(u),V(()=>k(H,n())),w(B,u)});var C=p(x);I(C,c,B=>{var u=dt(),H=g(u);_(u),V(()=>k(H,c())),w(B,u)});var A=p(C);_(o),V(()=>{y(o,"viewBox",h()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",f()),y(A,"fill",v())}),w(a,o)}function ut(){let a=D(null);return{get map(){return t(a)},set map(e){b(a,E(e))}}}const O=ut(),ft=async a=>{const e=`${$.api_url}/annotations/${a}`;return de(e)};async function _t(a,e){const r=`${$.api_url}/annotations/classification`;return de(r,"POST",{label:a,imageId:e})}async function ht(a,e,r){const l=`${$.api_url}/annotations/detection`;return de(l,"POST",{bb:a,label:e,imageId:r})}async function gt(a,e,r){const l=`${$.api_url}/annotations/segmentation`;return de(l,"POST",{layer_data:a,label:e,imageId:r})}const mt=async a=>{const e=`${$.api_url}/annotations/${a}`;return de(e,"DELETE")};async function bt(a,e){const r=`${$.api_url}/annotations/detection/${a}`;return de(r,"PUT",{bb:e})}function wt(){let a=D(E([])),e=D(!0),r=D(null),l=D(null);return{get data(){return t(a)},get loading(){return t(e)},get error(){return t(r)},get current(){return t(l)},set current(i){b(l,E(i))},retrieve:async i=>{b(e,!0);const{data:v,error:h}=await ft(i);return h&&b(r,E(h.message)),b(a,E(v)),b(e,!1),v},createClassification:async(i,v)=>{const{data:h,error:d}=await _t(i,v);if(d)throw new Error(d.message);t(a).find(f=>f.id===h.id)?b(a,E(t(a).map(f=>f.id===h.id?h:f))):b(a,E([h,...t(a)]))},createDetection:async(i,v,h)=>{const{data:d,error:f}=await ht(i,v,h);if(f)throw new Error(f.message);return b(a,E([d,...t(a)])),d},updateDetection:async(i,v)=>{const{data:h,error:d}=await bt(i,v);if(d)throw new Error(d.message);b(a,E(t(a).map(f=>f.id===i?{...f,bb:v}:f)))},createSegmentation:async(i,v,h)=>{const{data:d,error:f}=await gt(i,v,h);if(f)throw new Error(f.message);return b(a,E([d,...t(a)])),d},delete:async i=>{const{error:v}=await mt(i);if(v)throw new Error(v.message);b(a,E(t(a).filter(h=>h.id!==i)))},reset:()=>{b(a,E([])),b(e,!0),b(r,null),b(l,null)},append:i=>{b(a,E([...i,...t(a)]))}}}const P=wt(),Lt=async a=>{const e=`${$.api_url}/images/${a}`;return de(e)};function yt(){let a=D(E([])),e=D(!0),r=D(null),l=D(null);return{get data(){return t(a)},get loading(){return t(e)},get error(){return t(r)},get current(){return t(l)},set current(i){b(l,E(i))},retrieve:async i=>{b(e,!0);const{data:v,error:h}=await Lt(i);h&&b(r,E(h.message)),b(a,E(v)),b(e,!1)},zoom:(i,v)=>{const h=L.latLng(i[1],i[0]),d=L.latLng(i[3],i[2]),f=L.latLngBounds(h,d);v.fitBounds(f)},reset:()=>{b(a,E([])),b(e,!0),b(r,null),b(l,null)}}}const S=yt();function xt(){let a=D(null),e=D(null),r,l,i;const v=async n=>{const{layer:m}=n,o=m.getBounds(),x=await P.createDetection([[o._southWest.lat,o._northEast.lng],[o._northEast.lat,o._southWest.lng]],Z.current,S.current.id);m.options.color=Z.data.filter(C=>x.value==C.name)[0].color,m.annotationId=x.id,t(a).addLayer(m)},h=n=>{n.layers.eachLayer(m=>{const o=m.getBounds();P.updateDetection(m.annotationId,[[o._southWest.lat,o._northEast.lng],[o._northEast.lat,o._southWest.lng]])})},d=n=>{n.layers.eachLayer(m=>{P.delete(m.annotationId)})},f=n=>{t(a)?t(a).clearLayers():b(a,E(new L.FeatureGroup)),n.addLayer(t(a))};return{initItems:f,initControls:n=>{t(a)||f(n),r&&n.off(L.Draw.Event.CREATED,r),l&&n.off(L.Draw.Event.EDITED,l),i&&n.off(L.Draw.Event.DELETED,i),t(e)&&n.removeControl(t(e)),b(e,E(new L.Control.Draw({position:"topright",edit:{featureGroup:t(a)},draw:{polyline:!1,circlemarker:!1,circle:!1,marker:!1,rectangle:{repeatMode:!0,showArea:!1,showLength:!0,shapeOptions:{weight:1}},polygon:!1}}))),n.addControl(t(e)),r=async m=>await v(m),l=h,i=d,n.on(L.Draw.Event.CREATED,r),n.on(L.Draw.Event.EDITED,l),n.on(L.Draw.Event.DELETED,i)},remove:n=>{t(a)&&(n==null||n.removeLayer(t(a))),t(e)&&(n==null||n.removeControl(t(e))),r&&n.off(L.Draw.Event.CREATED,r),l&&n.off(L.Draw.Event.EDITED,l),i&&n.off(L.Draw.Event.DELETED,i),b(a,null),b(e,null)},addLayer:n=>{const m=n.bb,o=L.rectangle([[m[0][0],m[0][1]],[m[1][0],m[1][1]]],{editing:!0});o.options.color=Z.data.filter(x=>n.value==x.name)[0].color,o.annotationId=n.id,t(a).addLayer(o)},removeLayer:n=>{t(a).eachLayer(m=>{m.annotationId===n&&t(a).removeLayer(m)})}}}const W=xt();function pt(){let a=D(null),e=D(null);const r=()=>P.data.find(c=>c.value==Z.current&&c.type=="segmentation"),l=()=>{if(r()){const c=r();t(e).setData(c.layer_data),t(e).options.layerOptions.color=Z.data.filter(n=>c.value==n.name)[0].color,t(a).eachLayer(n=>{n.annotationId===c.id&&t(a).removeLayer(n)})}},i=async()=>{var n;const c=(n=t(e))==null?void 0:n.getData();if(c)try{if(r()){const x=r();v(x.id)}const m=await P.createSegmentation(c,Z.current,S.current.id),o=L.geoJSON(c,{style:{color:Z.data.filter(x=>m.value==x.name)[0].color}});o.annotationId=m.id,t(a).addLayer(o),t(e).eraseAll()}catch(m){console.error("Error saving annotation:",m)}},v=c=>{t(a).eachLayer(n=>{n.annotationId===c&&(t(a).removeLayer(n),P.delete(c))}),P.delete(c)};return{initItems:c=>{t(a)?t(a).clearLayers():b(a,E(new L.FeatureGroup)),c.addLayer(t(a))},initControls:c=>{t(e)&&(t(e).stop(),c.removeControl(t(e))),b(e,E(L.control.paintPolygon({layerOptions:{color:Z.data.filter(n=>Z.current==n.name)[0].color}}))),c.addControl(t(e)),c.on("mousedown",l),c.on("mouseup",i)},addLayer:c=>{const n=L.geoJSON(c.layer_data,{style:{color:Z.data.filter(m=>c.value==m.name)[0].color}});n.annotationId=c.id,t(a).addLayer(n)},remove:c=>{t(e)&&(t(e).stop(),t(e).eraseAll(),c.removeControl(t(e)),c.off("mousedown",l),c.off("mouseup",i)),t(a)&&(c==null||c.removeLayer(t(a))),b(a,null),b(e,null)},removeLayer:v}}const J=pt();function Ht(a,e){j(e,!0),F(async()=>{await Le(()=>import("../chunks/leaflet.draw.cJkf-kdY.js"),[],import.meta.url),await Le(()=>Promise.resolve({}),__vite__mapDeps([0]),import.meta.url);const r=await P.retrieve(S.current.id),l=O.map;J.remove(l),W.initControls(l),W.initItems(O.map),r==null||r.forEach(i=>{i.type==="detection"&&W.addLayer(i)})}),ye(()=>{W.remove(O.map)}),G()}function Ct(a,e){j(e,!0),F(async()=>{await Le(()=>import("../chunks/Leaflet.PaintPolygon.BL41ABOh.js"),[],import.meta.url);const r=O.map;W.remove(r),J.initControls(r),J.initItems(r);const l=await P.retrieve(S.current.id);l==null||l.forEach(i=>{i.type==="segmentation"&&J.addLayer(i)})}),ye(()=>{J.remove(O.map)}),G()}var Bt=M("<desc> </desc>"),Et=M("<title> </title>"),Vt=M('<svg><!><!><path d="M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C15.76,17.5 19.17,15.36 20.82,12C19.17,8.64 15.76,6.5 12,6.5C8.24,6.5 4.83,8.64 3.18,12Z"></path></svg>');function It(a,e){let r=s(e,"size",8,"1em"),l=s(e,"width",24,r),i=s(e,"height",24,r),v=s(e,"color",8,"currentColor"),h=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),f=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=Vt(),x=g(o);I(x,n,B=>{var u=Bt(),H=g(u);_(u),V(()=>k(H,n())),w(B,u)});var C=p(x);I(C,c,B=>{var u=Et(),H=g(u);_(u),V(()=>k(H,c())),w(B,u)});var A=p(C);_(o),V(()=>{y(o,"viewBox",h()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",f()),y(A,"fill",v())}),w(a,o)}const Dt=async(a,e,r)=>{if(e()){b(r,"classification");try{await P.createClassification(Z.current,S.current.id)}catch(l){console.error(l)}}},At=(a,e,r)=>{e()&&b(r,"detection")},kt=(a,e,r)=>{e()&&b(r,"segmentation")},Mt=async(a,e)=>{b(e,null);const r=await P.retrieve(S.current.id);W.initItems(O.map),J.initItems(O.map),r==null||r.forEach(l=>{l.type==="detection"&&W.addLayer(l),l.type==="segmentation"&&J.addLayer(l)})};var zt=T('<button data-tip="Classification"><!></button> <button data-tip="Detection"><!></button> <button data-tip="Segmentation"><!></button> <button data-tip="See all annotations"><!></button> <!> <!>',1);function St(a,e){j(e,!0);let r=D(null);const l=()=>S.current?Z.current?!0:alert("Select label"):alert("Select image");var i=zt(),v=q(i);v.__click=[Dt,l,r];var h=g(v);rt(h,{size:"15"}),_(v);var d=p(v,2);d.__click=[At,l,r];var f=g(d);nt(f,{size:"15"}),_(d);var c=p(d,2);c.__click=[kt,l,r];var n=g(c);vt(n,{size:"15"}),_(c);var m=p(c,2);m.__click=[Mt,r];var o=g(m);It(o,{size:"15"}),_(m);var x=p(m,2);I(x,()=>t(r)==="detection",A=>{Ht(A,{})});var C=p(x,2);I(C,()=>t(r)==="segmentation",A=>{Ct(A,{})}),V(()=>{re(v,`btn ${(t(r)==="classification"?"btn-primary":"btn-outline")??""} btn-sm tooltip tooltip-right flex items-center p-2`),re(d,`btn ${(t(r)==="detection"?"btn-primary":"btn-outline")??""} btn-sm tooltip flex items-center p-2`),re(c,`btn ${(t(r)==="segmentation"?"btn-primary":"btn-outline")??""} btn-sm tooltip flex items-center p-2`),re(m,`btn ${(t(r)===null?"btn-primary":"btn-outline")??""} btn-sm tooltip flex items-center p-2`)}),w(a,i),G()}_e(["click"]);var Tt=M("<desc> </desc>"),Ot=M("<title> </title>"),Pt=M('<svg><!><!><path d="M17.5 15.5C17.5 16.61 16.61 17.5 15.5 17.5S13.5 16.61 13.5 15.5 14.4 13.5 15.5 13.5 17.5 14.4 17.5 15.5M8.5 13.5C7.4 13.5 6.5 14.4 6.5 15.5S7.4 17.5 8.5 17.5 10.5 16.61 10.5 15.5 9.61 13.5 8.5 13.5M23 15V18C23 18.55 22.55 19 22 19H21V20C21 21.11 20.11 22 19 22H5C3.9 22 3 21.11 3 20V19H2C1.45 19 1 18.55 1 18V15C1 14.45 1.45 14 2 14H3C3 10.13 6.13 7 10 7H11V5.73C10.4 5.39 10 4.74 10 4C10 2.9 10.9 2 12 2S14 2.9 14 4C14 4.74 13.6 5.39 13 5.73V7H14C17.87 7 21 10.13 21 14H22C22.55 14 23 14.45 23 15M21 16H19V14C19 11.24 16.76 9 14 9H10C7.24 9 5 11.24 5 14V16H3V17H5V20H19V17H21V16Z"></path></svg>');function Nt(a,e){let r=s(e,"size",8,"1em"),l=s(e,"width",24,r),i=s(e,"height",24,r),v=s(e,"color",8,"currentColor"),h=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),f=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=Pt(),x=g(o);I(x,n,B=>{var u=Tt(),H=g(u);_(u),V(()=>k(H,n())),w(B,u)});var C=p(x);I(C,c,B=>{var u=Ot(),H=g(u);_(u),V(()=>k(H,c())),w(B,u)});var A=p(C);_(o),V(()=>{y(o,"viewBox",h()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",f()),y(A,"fill",v())}),w(a,o)}var Rt=T('<div class="w-[2px] h-[30px] bg-slate-500 self-center rounded-full"></div>');function Te(a){var e=Rt();w(a,e)}const Zt=async(a,e,r)=>{if(!S.current)return alert("Select image");if(!t(e))return alert("Select model");b(r,!0);try{const l=await pe.inference(t(e),S.current.id);l==null||l.forEach(i=>{i.type==="detection"&&W.addLayer(i),i.type==="segmentation"&&J.addLayer(i)}),P.append(l),O.map.addLayer(L.geoJSON(l))}catch(l){console.error(l),alert(l)}finally{b(r,!1)}};var Ft=T("<option> </option>"),jt=T('<!> <select class="select select-sm"><option disabled>Select a model</option><!></select> <button class="btn btn-sm tooltip flex items-center p-2 btn-outline" data-tip="Run model inference"><!></button> <!>',1);function Gt(a,e){j(e,!0);const r=He(),l=()=>Ce(Be,"$page",r);let i=D(null),v=D(!1);F(()=>{pe.retrieve(l().params.campaign)});var h=ve(),d=q(h);I(d,()=>{var f;return((f=pe.data)==null?void 0:f.length)>0},f=>{var c=jt(),n=q(c);Te(n);var m=p(n,2),o=g(m);o.value=(o.__value=null)==null?"":null;var x=p(o);ue(x,17,()=>pe.data,fe,(u,H)=>{var R=Ft(),z={},N=g(R);_(R),V(()=>{z!==(z=t(H).id)&&(R.value=(R.__value=t(H).id)==null?"":t(H).id),k(N,t(H).name)}),w(u,R)}),_(m);var C=p(m,2);C.__click=[Zt,i,v];var A=g(C);Nt(A,{size:"15"}),_(C);var B=p(C,2);Te(B),V(()=>C.disabled=t(v)),Ue(m,()=>t(i),u=>b(i,u)),w(f,c)}),w(a,h),G()}_e(["click"]);function Wt(){let a=D(null);return{set showImageBBs(e){b(a,E(e)),localStorage.setItem("showImageBBs",e)},get showImageBBs(){return t(a)},init:()=>{b(a,localStorage.getItem("showImageBBs")==="true")}}}const se=Wt();function Jt(){let a=D(null);return{initItems:e=>{t(a)?t(a).clearLayers():b(a,E(new L.FeatureGroup)),e.addLayer(t(a))},addBbox:(e,r)=>{let l=e.bbox;l=L.rectangle([[l[1],l[0]],[l[3],l[2]]],{interactive:!0,weight:10}),l.annotationId=e.path,l.on("click",()=>{r.fitBounds(l.getBounds()),S.current=e}),t(a).addLayer(l)},zoom:e=>{const r=t(a).getBounds();r.isValid()&&e.fitBounds(r)},toggle:e=>{se.showImageBBs?(e.removeLayer(t(a)),se.showImageBBs=!1):(e.addLayer(t(a)),se.showImageBBs=!0)},hide:e=>{e==null||e.removeLayer(t(a))},remove:e=>{e==null||e.removeLayer(t(a))}}}const ne=Jt();var Ut=M("<desc> </desc>"),qt=M("<title> </title>"),Kt=M('<svg><!><!><path d="M20,16V10H22V16A2,2 0 0,1 20,18H8C6.89,18 6,17.1 6,16V4C6,2.89 6.89,2 8,2H16V4H8V16H20M10.91,7.08L14,10.17L20.59,3.58L22,5L14,13L9.5,8.5L10.91,7.08M16,20V22H4A2,2 0 0,1 2,20V7H4V20H16Z"></path></svg>');function Qt(a,e){let r=s(e,"size",8,"1em"),l=s(e,"width",24,r),i=s(e,"height",24,r),v=s(e,"color",8,"currentColor"),h=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),f=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=Kt(),x=g(o);I(x,n,B=>{var u=Ut(),H=g(u);_(u),V(()=>k(H,n())),w(B,u)});var C=p(x);I(C,c,B=>{var u=qt(),H=g(u);_(u),V(()=>k(H,c())),w(B,u)});var A=p(C);_(o),V(()=>{y(o,"viewBox",h()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",f()),y(A,"fill",v())}),w(a,o)}var Xt=M("<desc> </desc>"),Yt=M("<title> </title>"),$t=M('<svg><!><!><path d="M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22H20A2,2 0 0,0 22,20V12A10,10 0 0,0 12,2M13,7H11V11H7V13H11V17H13V13H17V11H13V7Z"></path></svg>');function ea(a,e){let r=s(e,"size",8,"1em"),l=s(e,"width",24,r),i=s(e,"height",24,r),v=s(e,"color",8,"currentColor"),h=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),f=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=$t(),x=g(o);I(x,n,B=>{var u=Xt(),H=g(u);_(u),V(()=>k(H,n())),w(B,u)});var C=p(x);I(C,c,B=>{var u=Yt(),H=g(u);_(u),V(()=>k(H,c())),w(B,u)});var A=p(C);_(o),V(()=>{y(o,"viewBox",h()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",f()),y(A,"fill",v())}),w(a,o)}var ta=()=>ne.toggle(O.map),aa=()=>ne.zoom(O.map),ra=T('<section class="flex flex-row gap-2"><span><button><!></button></span> <button class="btn btn-sm btn-outline tooltip tooltip-left flex items-center p-2" data-tip="Reset map"><!></button></section>');function oa(a,e){j(e,!0),F(()=>{se.init()});var r=ra(),l=g(r),i=g(l);i.__click=[ta];var v=g(i);Qt(v,{size:"15"}),_(i),_(l);var h=p(l,2);h.__click=[aa];var d=g(h);ea(d,{size:"15"}),_(h),_(r),V(()=>{re(i,`btn btn-sm tooltip flex items-center p-2 ${(se.showImageBBs?"btn-primary":"btn-outline")??""}`),y(i,"data-tip",`${(se.showImageBBs?"Hide":"Show")??""} bbs`)}),w(a,r),G()}_e(["click"]);var ia=T('<nav class="flex flex-row gap-2 bg-bg2 p-3 border-b border-t border-border justify-between"><span class="flex flex-row gap-2"><!> <!> <!></span> <span class="flex flex-row gap-2"><!></span></nav>');function la(a,e){j(e,!0);const r=He(),l=()=>Ce(Be,"$page",r);let i=D("");F(()=>{b(i,E(l().url.searchParams.get("id")))});var v=ia(),h=g(v),d=g(h);St(d,{});var f=p(d,2);Gt(f,{});var c=p(f,2),n=Pe(()=>`${$.url}/campaigns/export?id=${t(i)}`);Ke(c,{get link(){return t(n)}}),_(h);var m=p(h,2),o=g(m);oa(o,{}),_(m),_(v),w(a,v),G()}var na=T('<div id="map" class="svelte-g0bqmp"><!></div>');function sa(a,e){j(e,!0);let r=D(null),l={attributionControl:!1,max_zoom:20};F(async()=>{var d;const h=await Le(()=>import("../chunks/leaflet-src.DTmlu4rB.js").then(f=>f.l),[],import.meta.url);return await Le(()=>Promise.resolve({}),__vite__mapDeps([1]),import.meta.url),b(r,E(h.map("map",l).setView(e.position,e.zoom))),t(r).zoomControl.setPosition("bottomright"),(d=e.panes)==null||d.forEach(({name:f,zIndex:c})=>{t(r).createPane(f),t(r).getPane(f).style.zIndex=c,t(r).getPane(f).style.pointerEvents="none"}),O.map=t(r),()=>t(r).remove()}),Ge("map",{getMap:()=>t(r)});var i=na(),v=g(i);Qe(v,()=>e.children),_(i),w(a,i),G()}var da=T("<p>No annotations found</p>"),ca=(a,e,r)=>e(t(r).id),va=T('<tr class="h-8 hover:bg-slate-100"><td> </td><td> </td><td class="w-8"><button class="px-2 hover:text-red-600"><!></button></td></tr>'),ua=T('<div class="flex-grow overflow-auto"><table class="table w-full"><thead><tr><th class="sticky top-0 text-left bg-bg2">Label</th><th class="sticky top-0 text-left bg-bg2">Type</th><th class="sticky top-0 bg-bg2"></th></tr></thead><tbody></tbody></table></div>'),fa=T('<section class="flex flex-col flex-1 h-full overflow-hidden"><!></section>');function _a(a,e){j(e,!1);const r=v=>{confirm("Are you sure you want to delete this annotation? This action is irreversible.")&&(P.delete(v),W.removeLayer(v),J.removeLayer(v))};Xe();var l=fa(),i=g(l);I(i,()=>P.data.length==0,v=>{var h=da();w(v,h)},v=>{var h=ua(),d=g(h),f=p(g(d));ue(f,5,()=>P.data,fe,(c,n)=>{var m=va(),o=g(m),x=g(o);_(o);var C=p(o),A=g(C);_(C);var B=p(C),u=g(B);u.__click=[ca,r,n];var H=g(u);qe(H,{size:"15"}),_(u),_(B),_(m),V(()=>{k(x,t(n).value),k(A,t(n).type)}),w(c,m)}),_(f),_(d),_(h),w(v,h)}),_(l),w(a,l),G()}_e(["click"]);var ha=M("<desc> </desc>"),ga=M("<title> </title>"),ma=M('<svg><!><!><path d="M6.1,10L4,18V8H21A2,2 0 0,0 19,6H12L10,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H19C19.9,20 20.7,19.4 20.9,18.5L23.2,10H6.1M19,18H6L7.6,12H20.6L19,18Z"></path></svg>');function ba(a,e){let r=s(e,"size",8,"1em"),l=s(e,"width",24,r),i=s(e,"height",24,r),v=s(e,"color",8,"currentColor"),h=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),f=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=ma(),x=g(o);I(x,n,B=>{var u=ha(),H=g(u);_(u),V(()=>k(H,n())),w(B,u)});var C=p(x);I(C,c,B=>{var u=ga(),H=g(u);_(u),V(()=>k(H,c())),w(B,u)});var A=p(C);_(o),V(()=>{y(o,"viewBox",h()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",f()),y(A,"fill",v())}),w(a,o)}var wa=M("<desc> </desc>"),La=M("<title> </title>"),ya=M('<svg><!><!><path d="M19,19H5V5H19M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M13.96,12.29L11.21,15.83L9.25,13.47L6.5,17H17.5L13.96,12.29Z"></path></svg>');function xa(a,e){let r=s(e,"size",8,"1em"),l=s(e,"width",24,r),i=s(e,"height",24,r),v=s(e,"color",8,"currentColor"),h=s(e,"viewBox",8,"0 0 24 24"),d=s(e,"ariaLabel",24,()=>{}),f=s(e,"ariaHidden",24,()=>{}),c=s(e,"title",24,()=>{}),n=s(e,"desc",24,()=>{}),m=s(e,"class",24,()=>{});var o=ya(),x=g(o);I(x,n,B=>{var u=wa(),H=g(u);_(u),V(()=>k(H,n())),w(B,u)});var C=p(x);I(C,c,B=>{var u=La(),H=g(u);_(u),V(()=>k(H,c())),w(B,u)});var A=p(C);_(o),V(()=>{y(o,"viewBox",h()),y(o,"width",l()),y(o,"height",i()),Y(o,m()),y(o,"aria-label",d()),y(o,"aria-hidden",f()),y(A,"fill",v())}),w(a,o)}var pa=(a,e,r)=>e(t(r)),Ha=T('<button class="text-nowrap hover:underline"> </button>'),Ca=(a,e,r)=>e(t(r)),Ba=T('<tr class="hover:bg-slate-100"><td><button class="flex hover:underline items-center gap-1 w-full"><!> </button></td></tr>'),Ea=(a,e,r,l)=>e(t(r)[t(l)]),Va=T('<tr><td class="pr-1"><button class="w-full"><p class="flex items-center gap-1 w-full"><!> </p></button></td></tr>'),Ia=T('<tr><th class="text-left"> </th><td class="pl-1"> </td></tr>'),Da=T('<p> </p> <div class="overflow-auto flex-grow flex flex-col gap-2"><input type="text" placeholder="Search in folder ..." class="p-1 rounded-md input-sm w-full"> <div class="text-sm flex"><p>Path: /</p> <!></div> <div class="overflow-auto flex-grow"><table class="w-full"><tbody><!></tbody></table></div></div>',1),Aa=T("<p>No files found.</p>"),ka=T("<p>Loading files ...</p>"),Ma=T('<div class="flex flex-col gap-2 h-full overflow-hidden"><!></div>');function za(a,e){j(e,!0);const r=He(),l=()=>Ce(Be,"$page",r);let i=D(E({})),v=D(E([])),h=D(!1),d=D(E([])),f=D(!1),c=E({}),n=D(null);F(async()=>{S.retrieve(l().url.searchParams.get("id"))}),F(async()=>{b(h,!0),b(i,E({})),b(v,E([]));let z=m();b(i,E(z)),b(h,!1)}),ye(()=>{S.reset()});const m=()=>{const z={};return S.data.forEach(N=>{const ee=N.path.split(N.path.includes("\\")?"\\":"/");let Q=z;ee.forEach((X,he)=>{he==ee.length-1?Q[X]=N:(Q[X]||(Q[X]={}),Q=Q[X])})}),z},o=z=>{b(v,E([...t(v),t(i)])),b(i,E(t(i)[z])),B(z)},x=()=>{t(f)?(b(d,E(t(d).slice(0,t(d).length-1))),b(f,!1)):(b(i,E(t(v).pop())),b(d,E(t(d).slice(0,t(d).length-1))))},C=z=>{const N=t(d).indexOf(z)+1;t(d).length>t(v).length&&z.split(".").length<2&&(b(f,!1),b(d,E(t(d).slice(0,t(d).length-1))));for(let ee=0;t(v).length-N>0;(ee+=1)-1)x()},A=z=>{S.current=z},B=z=>{t(v).length>0?b(d,E([...t(d),z])):b(d,E([]))};let u=Pe(()=>()=>t(n)?Object.keys(t(i)).filter(z=>z.toLowerCase().includes(t(n).toLowerCase())):Object.keys(t(i)));var H=Ma(),R=g(H);I(R,()=>!t(h),z=>{var N=ve(),ee=q(N);I(ee,()=>S.data,Q=>{var X=Da(),he=q(X),Re=g(he);_(he);var De=p(he,2),Ee=g(De);Ne(Ee);var Ve=p(Ee,2),Ze=p(g(Ve),2);ue(Ze,17,()=>t(d),fe,(oe,te)=>{var ae=Ha();ae.__click=[pa,C,te];var ge=g(ae);_(ae),V(()=>k(ge,`${t(te)??""}/`)),w(oe,ae)}),_(Ve);var Ae=p(Ve,2),ke=g(Ae),Me=g(ke),Fe=g(Me);I(Fe,()=>t(f)==!1,oe=>{var te=ve(),ae=q(te);ue(ae,17,()=>t(u)(),fe,(ge,K)=>{var ce=ve(),me=q(ce);I(me,()=>typeof t(i)[t(K)]=="object"&&!t(i)[t(K)].id,be=>{var U=Ba(),ie=g(U),le=g(ie);le.__click=[Ca,o,K];var we=g(le);ba(we,{size:"15"});var xe=p(we,1,!0);_(le),_(ie),_(U),V(()=>k(xe,t(K))),w(be,U)},be=>{var U=Va(),ie=g(U),le=g(ie);le.__click=[Ea,A,i,K];var we=g(le),xe=g(we);xa(xe,{size:"15"});var je=p(xe,1,!0);_(we),_(le),_(ie),_(U),V(()=>{var ze,Se;re(U,`hover:bg-slate-100 ${(((ze=S.current)==null?void 0:ze.id)==((Se=t(i)[t(K)])==null?void 0:Se.id)?"bg-slate-100":"")??""}`),k(je,t(K))}),w(be,U)}),w(ge,ce)}),w(oe,te)},oe=>{var te=ve(),ae=q(te);ue(ae,17,()=>Object.keys(c),fe,(ge,K)=>{var ce=Ia(),me=g(ce),be=g(me);_(me);var U=p(me),ie=g(U);_(U),_(ce),V(()=>{k(be,`${t(K)??""}:`),k(ie,c[t(K)])}),w(ge,ce)}),w(oe,te)}),_(Me),_(ke),_(Ae),_(De),V(()=>k(Re,`Images (${S.data.length??""}) :`)),Ye(Ee,()=>t(n),oe=>b(n,oe)),w(Q,X)},Q=>{var X=Aa();w(Q,X)}),w(z,N)},z=>{var N=ka();w(z,N)}),_(H),w(a,H),G()}_e(["click"]);var Sa=(a,e)=>b(e,"labels"),Ta=(a,e)=>b(e,"annotations"),Oa=T('<div class="flex flex-col p-3 border-l bg-bg2 border-border w-[300px] h-full justify-between"><div class="h-[250px]"><!></div> <div class="flex flex-col flex-1 h-full"><div class="w-full h-[2px] bg-slate-500 rounded-full my-2"></div> <span class="flex gap-4"><button>Labels</button> <button>Annotations</button></span> <!> <!></div></div>');function Pa(a,e){j(e,!0);let r=D("labels");F(async()=>{if(S.current){const o=await P.retrieve(S.current.id);W.initItems(O.map),J.initItems(O.map),o==null||o.forEach(x=>{x.type==="detection"&&W.addLayer(x),x.type==="segmentation"&&J.addLayer(x)})}}),ye(()=>{Z.reset(),W.remove(O.map),J.remove(O.map),P.reset()});var l=Oa(),i=g(l),v=g(i);za(v,{}),_(i);var h=p(i,2),d=p(g(h),2),f=g(d);f.__click=[Sa,r];var c=p(f,2);c.__click=[Ta,r],_(d);var n=p(d,2);I(n,()=>t(r)==="labels",o=>{Je(o,{})});var m=p(n,2);I(m,()=>t(r)==="annotations",o=>{_a(o,{})}),_(h),_(l),V(()=>{re(f,`pb-1 ${(t(r)==="labels"?"border-b-2 border-primary":"")??""}`),re(c,`pb-1 ${(t(r)==="annotations"?"border-b-2 border-primary":"")??""}`)}),w(a,l),G()}_e(["click"]);function Oe(a,e){j(e,!0);const{getMap:r}=We("map");let l=null;F(()=>{const i=r();return i&&(l=L.tileLayer(e.url,e.options).addTo(i)),()=>l==null?void 0:l.remove()}),G()}var Na=T('<label class="svelte-u9pskg"><input type="radio" name="layers"> </label>'),Ra=T('<form class="svelte-u9pskg"></form>');function Za(a,e){const r=[];let l=s(e,"layers",19,()=>["streets","satellite"]),i=s(e,"layer",15);var v=Ra();ue(v,21,l,fe,(h,d)=>{var f=Na(),c=g(f);Ne(c);var n,m=p(c);_(f),V(()=>{n!==(n=t(d))&&(c.value=(c.__value=t(d))==null?"":t(d)),k(m,` ${t(d)??""}`)}),$e(r,[],c,()=>(t(d),i()),i),w(h,f)}),_(v),w(a,v)}function Fa(a,e){j(e,!0);let r=s(e,"stretch",19,()=>[0,3e3]),l=s(e,"bands",19,()=>[4,3,2]),i=s(e,"palette",3,"viridis"),v=D(null),h=D(!1);F(()=>{const d=O.map;d&&(t(h)||(ne.initItems(d),S.data.forEach(f=>{ne.addBbox(f,d)}),ne.zoom(d)),se.showImageBBs||ne.hide(d),S.data.length>0&&b(h,!0))}),F(()=>{const d=O.map;if(d&&S.current){S.zoom(S.current.bbox,d);let f=`${$.api_url}/images/${S.current.path}/{z}/{x}/{y}.png?stretch=${r()}&bands=${l()}&palette=${i()}`;Ie.current.eotdlDatasetId&&(f+=`&eotdlDatasetId=${Ie.current.eotdlDatasetId}`),t(v)?t(v).setUrl(f):b(v,E(L.tileLayer(f,e.options).addTo(d)))}}),ye(()=>{ne.remove(O.map),b(h,!1)}),G()}var ja=T("<!> <!>",1),Ga=T('<div class="flex flex-col flex-1 h-full"><!> <div class="flex flex-row flex-1 w-full h-full"><div class="flex-1"><!></div> <div class="w-[300px]"><!></div></div></div> <!>',1);function fr(a,e){j(e,!0);const r=He(),l=()=>Ce(Be,"$page",r);let i=D("streets");F(()=>{Ie.retrieveOne(l().url.searchParams.get("id"))});var v=Ga(),h=q(v),d=g(h);la(d,{});var f=p(d,2),c=g(f),n=g(c);sa(n,{position:[42.0407,3.1],zoom:4,children:(C,A)=>{var B=ja(),u=q(B);I(u,()=>t(i)=="streets",R=>{Oe(R,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{maxZoom:20,zIndex:1}})},R=>{var z=ve(),N=q(z);I(N,()=>t(i)=="satellite",ee=>{Oe(ee,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{maxZoom:20,zIndex:1}})},null,!0),w(R,z)});var H=p(u,2);Za(H,{layers:["streets","satellite"],get layer(){return t(i)},set layer(R){b(i,E(R))}}),w(C,B)},$$slots:{default:!0}}),_(c);var m=p(c,2),o=g(m);Pa(o,{}),_(m),_(f),_(h);var x=p(h,2);I(x,()=>S.data,C=>{Fa(C,{})}),w(a,v),G()}export{fr as component};
